"use strict";(self.webpackChunkpyramid=self.webpackChunkpyramid||[]).push([[39],{39:($,Z,l)=>{l.r(Z),l.d(Z,{SetContentsModule:()=>K});var u=l(9808),b=l(6037),m=l(9600),A=l(7577),y=l(9028),S=l(4499),f=l(5861),x=l(655),s=l(2382),g=l(4987),v=l(9783),t=l(5e3),h=l(1528),T=l(845),q=l(5315),N=l(7773),C=l(1435),R=l(6347),J=l(3019),U=l(9165),Q=l(5949),Y=l(2501),k=l(9711);function j(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"dialog-header",21),t.NdJ("onClose",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.showAddRecipe=!1)}),t.qZA()}}function F(i,n){if(1&i&&(t.TgZ(0,"small",32),t._uU(1),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.hij("",e.label||"This"," barcode is the wrong length")}}function M(i,n){1&i&&(t.TgZ(0,"small",33),t._uU(1,"REQUIRED"),t.qZA())}function G(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"form",6),t.NdJ("ngSubmit",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.addRecipe())}),t.TgZ(1,"div",7)(2,"div",22)(3,"form-select",23),t.NdJ("changed",function(o){t.CHM(e);const c=t.oxw();return t.KtG(c.onRecipe(o))}),t.qZA(),t._UZ(4,"val-errors",12),t.qZA(),t.TgZ(5,"div",22),t._UZ(6,"form-number",24),t.qZA(),t._UZ(7,"val-errors",14),t.qZA(),t.TgZ(8,"div",25)(9,"div",26)(10,"form-barcode",27),t.NdJ("keyup.enter",function(o){t.CHM(e);const c=t.oxw();return t.KtG(c.onDestination(o.target.value))}),t.qZA(),t.TgZ(11,"val-errors",28),t.YNc(12,F,2,1,"ng-template",29),t.YNc(13,M,2,0,"ng-template",30),t.qZA()()(),t.TgZ(14,"div",31),t._uU(15),t.ALo(16,"json"),t.qZA()()}if(2&i){const e=t.oxw();let r;t.Q6J("formGroup",e.form),t.xp6(15),t.Oqu(t.lcZ(16,2,null==(r=e.recipeForm.get("quantity"))?null:r.errors))}}function E(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"dialog-footer",34),t.NdJ("onReject",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.showAddRecipe=!1)})("onAccept",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.addRecipe())}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("form",e.recipeForm)}}function I(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",35)(1,"button",36),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.cancel())}),t.qZA(),t.TgZ(2,"p-button",37),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.create())}),t.qZA()()}}function O(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.lnq(" ",e.control,": ",e.key," = ",e.errorValue," ")}}const D=function(){return{width:"50vw","max-width":"550px"}};let d=class{constructor(n,e,r,o,c){this.pyramid=n,this.store=e,this.biz=r,this.fb=o,this.ns=c,this.picklists=null,this.containerDefs=[],this.showAddRecipe=!1,this.aliquots=[],this.errors=[],this._aliquots=[{recipe:171,quantity:[35,144],destination:"100053"},{recipe:172,quantity:[120,144],destination:"100074"}],this.cols=[{field:"destination",header:"Destination"},{field:"recipe",header:"Recipe",render:a=>{var p,_;return null!==(_=null===(p=this.picklists)||void 0===p?void 0:p.name[a.recipe])&&void 0!==_?_:"-"}},{field:"quantity",header:"Quantity",render:a=>this.formatQuantity(null==a?void 0:a.quantity)},{type:"icon",icon:"delete",wd:30,click:(a,p)=>this.onClick(a,p)}]}ngOnInit(){var n=this;return(0,f.Z)(function*(){n.store.profile$.pipe((0,g.t)(n)).subscribe(e=>n.profile=e),n.store.picklists$.pipe((0,g.t)(n)).subscribe(e=>{n.picklists=e,n.aliquots=n._aliquots}),n.form=n.fb.group({destination:[null,[s.kI.required]],recipe:[null,[s.kI.required]],quantity:[null,[s.kI.required]]}),n.form.get("destination").valueChanges.subscribe(e=>{})})()}onClick(n,e){"delete"==n&&(this.aliquots=this.aliquots.filter(r=>r!=e),this.ns.toast("Worklist item removed"))}onDestination(n){this.addReagent(),this.form.patchValue({destination:null})}addReagent(){if(!this.form.invalid){const n=Object.assign({},this.form.value);this.aliquots=[...this.aliquots,n]}}formatQuantity(n){var e;return!n||!Array.isArray(n)||n.length<2||!n[2]?"-":`${n[0]}`+(2==n.length?` ${(null===(e=this.picklists)||void 0===e?void 0:e.name[n[1]])||""}`:"")}create(){var n=this;return(0,f.Z)(function*(){const e=[],r=(new Date).toISOString();n.aliquots.forEach(o=>{var c,a;console.log(`Aliquot ${o.quantity[0]} ${null===(c=n.picklists)||void 0===c?void 0:c.name[o.quantity[1]]} of ${null===(a=n.picklists)||void 0===a?void 0:a.name[o.recipe]} to ${o.destination}`),e.push({barcode:o.destination,wells:[{row:0,col:0,wellStatus:n.picklists.idByKey("WellStatus|Valid"),contents:[{recipeId:o.recipe,quantity:o.quantity[0],unitType:o.quantity[1],clientId:n.profile.clientId,changedBy:n.profile.id,changedOn:r}]}]})}),e.length>0&&(yield n.pyramid.setContents(e)),n.aliquots=[]})()}cancel(){var n=this;return(0,f.Z)(function*(){n.aliquots.length>0&&(yield n.ns.confirm("Clear Worklist","Are you sure you want to remove all worklist items?"))&&(n.aliquots=[])})()}getFormValidationErrors(n){this.errors=[],Object.keys(this.form.controls).forEach(e=>{const r=this.form.get(e).errors;null!=r&&Object.keys(r).forEach(o=>{this.errors.push({control:e,keyError:o,errorValue:r[o]})})})}};d.\u0275fac=function(n){return new(n||d)(t.Y36(h.tG),t.Y36(h.d6),t.Y36(h.Kc),t.Y36(s.QS),t.Y36(m.c))},d.\u0275cmp=t.Xpm({type:d,selectors:[["set-contents"]],features:[t._Bn([v.YP,v.ez])],decls:33,vars:22,consts:[[3,"visible","modal","draggable","resizable","visibleChange"],["pTemplate","header"],["pTemplate","content"],["pTemplate","footer"],[1,"flex","flex-column"],[1,"card"],[3,"formGroup","ngSubmit"],[1,"formgrid","grid"],[1,"field","col-12","md:col-6","lg:col-4"],["focus","","formControlName","destination","next","quantity","label","Destination","minlength","6"],["controlName","destination","label","The barcode"],["formControlName","recipe","label","Recipe","picklist","Recipe"],["controlName","recipe","label","The recipe"],["formControlName","quantity","label","Quantity","decimals","2","required","true","units","Units"],["controlName","quantity","label","The quantity"],["label","Add to Worklist","icon","pi pi-sort-down","iconPos","right",1,"mt-4",3,"disabled","click"],[1,"pt-2","text-dark"],[1,"card","p-0"],[3,"value","cols"],["class","flex mt-2 mb-2",4,"ngIf"],[4,"ngFor","ngForOf"],["icon","building","title","Add Recipe Content",3,"onClose"],[1,"field","col-6"],["formControlName","recipe","label","Recipe","picklist","Recipe",3,"changed"],["formControlName","quantity","label","Quantity","decimals","2","units","Units"],[1,"formgrid","grid","mb-3"],[1,"field","col-12","md:col-6","lg:col-4","mt-3"],["name","dst","formControlName","destination","label","Destination","prompt","Destination container barcode",3,"keyup.enter"],["controlName","destination"],["valError","barcodeLength"],["valError","required"],[1,"field","col-12"],[2,"color","red"],[2,"color","orange"],["acceptText","SUBMIT",3,"form","onReject","onAccept"],[1,"flex","mt-2","mb-2"],["pButton","","type","button","label","Clear",1,"p-button-outlined","p-button-secondary","ml-auto","mr-2",3,"click"],["label","Submit",1,"mr-2",3,"click"]],template:function(n,e){1&n&&(t._UZ(0,"p-toast"),t.TgZ(1,"p-dialog",0),t.NdJ("visibleChange",function(o){return e.showAddRecipe=o}),t.YNc(2,j,1,0,"ng-template",1),t.YNc(3,G,17,4,"ng-template",2),t.YNc(4,E,1,1,"ng-template",3),t.qZA(),t.TgZ(5,"div",4)(6,"div",5)(7,"form",6),t.NdJ("ngSubmit",function(){return e.addReagent()}),t.TgZ(8,"div",7)(9,"div",8),t._UZ(10,"form-barcode",9)(11,"val-errors",10),t.qZA()(),t.TgZ(12,"div",7)(13,"div",8),t._UZ(14,"form-select",11),t.qZA(),t._UZ(15,"val-errors",12),t.TgZ(16,"div",8),t._UZ(17,"form-number",13)(18,"val-errors",14),t.qZA()(),t.TgZ(19,"p-button",15),t.NdJ("click",function(){return e.addReagent()}),t.qZA()(),t.TgZ(20,"div",16),t._uU(21),t.ALo(22,"json"),t.qZA()(),t.TgZ(23,"div",17),t._UZ(24,"tbl",18),t.YNc(25,I,3,0,"div",19),t.qZA(),t.TgZ(26,"p"),t._uU(27),t.ALo(28,"json"),t.qZA(),t.TgZ(29,"p"),t._uU(30),t.ALo(31,"json"),t.qZA(),t.YNc(32,O,2,3,"div",20),t.qZA()),2&n&&(t.xp6(1),t.Akn(t.DdM(21,D)),t.Q6J("visible",e.showAddRecipe)("modal",!0)("draggable",!0)("resizable",!1),t.xp6(6),t.Q6J("formGroup",e.form),t.xp6(12),t.Q6J("disabled",e.form.invalid),t.xp6(2),t.Oqu(t.lcZ(22,15,e.form.value)),t.xp6(3),t.Q6J("value",e.aliquots)("cols",e.cols),t.xp6(1),t.Q6J("ngIf",null==e.aliquots?null:e.aliquots.length),t.xp6(2),t.hij("Form value: ",t.lcZ(28,17,e.form.value),""),t.xp6(3),t.hij("Form status: ",t.lcZ(31,19,e.form.status),""),t.xp6(2),t.Q6J("ngForOf",e.errors))},dependencies:[u.sg,u.O5,s._Y,s.JJ,s.JL,s.Q7,s.wO,s.sg,s.u,v.jx,T.Hq,T.zx,q.V,N.FN,C.tM,C.HY,R.J,J.Z,U.o,Q.A,Y.g,k.$,u.Ts]}),d=(0,x.gn)([(0,g.c)()],d);const H=[{path:"",component:d,canActivate:[y.a1]}];let K=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[u.ez,S.m,b.Bz.forChild(H),m.cB,m.Gv,m.yn,m.zY,m.S8,A.R,m.NY,C.bQ]}),i})()}}]);