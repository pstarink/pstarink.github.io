"use strict";(self.webpackChunkpyramid=self.webpackChunkpyramid||[]).push([[921],{3482:(N,f,a)=>{a.d(f,{a:()=>b});var m=a(1169);let b=(()=>{class p extends m.e{constructor(x){super(),Object.assign(this,x)}}return p.tableName="ContainerModels",p})()},921:(N,f,a)=>{a.r(f),a.d(f,{ManageLookupsModule:()=>te});var m=a(9808),b=a(6037),p=a(9600),T=a(7577),x=a(9028),A=a(4499),h=a(5861),B=a(655),y=a(9783),Z=a(3482),C=a(6264),k=a(4987),I=a(9544),n=a(1777);(0,n.X$)("dropdown",[(0,n.SB)("false",(0,n.oB)({height:0,opacity:0})),(0,n.SB)("true",(0,n.oB)({height:"*",opacity:1})),(0,n.eR)("false <=> true",(0,n.jt)("300ms cubic-bezier(.35, 0, .25, 1)"))]),function E(l){(0,n.X$)("fadeInRight",[(0,n.eR)(":enter",[(0,n.oB)({transform:"translateX(-20px)",opacity:0}),(0,n.jt)(`${l}ms cubic-bezier(0.35, 0, 0.25, 1)`,(0,n.oB)({transform:"translateX(0)",opacity:1}))])])}(400),function R(l){(0,n.X$)("fadeInUp",[(0,n.eR)(":enter",[(0,n.oB)({transform:"translateY(20px)",opacity:0}),(0,n.jt)(`${l}ms cubic-bezier(0.35, 0, 0.25, 1)`,(0,n.oB)({transform:"translateY(0)",opacity:1}))])])}(400),(0,n.X$)("transformPopover",[(0,n.eR)(":enter",[(0,n.oB)({opacity:0,transform:"scale(0.6)"}),(0,n.ru)([(0,n.jt)("100ms linear",(0,n.oB)({opacity:1})),(0,n.jt)("150ms cubic-bezier(0, 0, 0.2, 1)",(0,n.oB)({transform:"scale(1)"}))])]),(0,n.eR)(":leave",[(0,n.oB)({opacity:1}),(0,n.jt)("100ms linear",(0,n.oB)({opacity:0}))])]),function L(l){(0,n.X$)("scaleFadeIn",[(0,n.eR)(":enter",[(0,n.oB)({transform:"scale(0.8)",opacity:0}),(0,n.jt)(`${l}ms cubic-bezier(0.35, 0, 0.25, 1)`,(0,n.oB)({transform:"scale(1)",opacity:1}))])])}(400);const J=(0,n.X$)("scaleInOut",[(0,n.eR)(":enter",[(0,n.oB)({transform:"scale(0)",opacity:0}),(0,n.jt)("0.2s cubic-bezier(0.35, 0, 0.25, 1)",(0,n.oB)({transform:"scale(1)",opacity:1}))]),(0,n.eR)(":leave",[(0,n.oB)({transform:"scale(1)",opacity:1}),(0,n.jt)("0.2s cubic-bezier(0.35, 0, 0.25, 1)",(0,n.oB)({transform:"scale(0)",opacity:0}))])]);function g(l){return(0,n.X$)("stagger",[(0,n.eR)("* => *",[(0,n.IO)(":enter",(0,n.EY)(l,(0,n.pV)()),{optional:!0})])])}!function w(l){(0,n.X$)("scaleIn",[(0,n.eR)(":enter",[(0,n.oB)({transform:"scale(0)"}),(0,n.jt)(`${l}ms cubic-bezier(0.35, 0, 0.25, 1)`,(0,n.oB)({transform:"scale(1)"}))])])}(400),g(80),g(60),g(40),g(20);var e=a(5e3),_=a(1528),O=a(2e3),u=a(2382),M=a(845),S=a(4204),U=a(7773),j=a(2629),Q=a(1435),$=a(8821),Y=a(2301),z=a(3019),G=a(7329);function D(l,o){if(1&l){const t=e.EpF();e.TgZ(0,"div",3)(1,"div",4)(2,"button",5),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.expandAll())}),e.qZA(),e.TgZ(3,"button",6),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.collapseAll())}),e.qZA(),e._UZ(4,"button",7)(5,"button",8),e.qZA(),e.TgZ(6,"p-tree",9),e.NdJ("selectionChange",function(i){e.CHM(t);const r=e.oxw();return e.KtG(r.selectedNode=i)})("onNodeSelect",function(i){e.CHM(t);const r=e.oxw();return e.KtG(r.lookupSelect(i))}),e.qZA()()}if(2&l){const t=e.oxw();e.xp6(5),e.Q6J("disabled",null===t.lookup),e.xp6(1),e.Q6J("value",t.tree)("selection",t.selectedNode)("filter",!0)}}function K(l,o){if(1&l&&(e.TgZ(0,"div",21),e._UZ(1,"form-text",29),e.qZA()),2&l){const t=e.oxw(3);e.xp6(1),e.Q6J("disabled",!t.isEditing)}}function X(l,o){if(1&l&&(e.ynx(0),e.TgZ(1,"div",15)(2,"div",30),e._UZ(3,"form-number",31),e.qZA(),e.TgZ(4,"div",16),e._UZ(5,"form-number",32),e.qZA(),e.TgZ(6,"div",33),e._UZ(7,"form-number",34),e.qZA()(),e.BQk()),2&l){const t=e.oxw(3);e.xp6(3),e.Q6J("disabled",!t.isEditing),e.xp6(2),e.Q6J("disabled",!t.isEditing),e.xp6(2),e.Q6J("disabled",!t.isEditing)}}function H(l,o){if(1&l){const t=e.EpF();e.TgZ(0,"div",35)(1,"button",36),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.cancel())}),e.qZA(),e.TgZ(2,"p-button",37),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.accept())}),e.qZA()()}if(2&l){const t=e.oxw(3);e.Q6J("@scaleInOut",void 0),e.xp6(2),e.Q6J("disabled",!t.form.valid||!t.changed)}}const F=function(){return{"max-width":"1000px"}};function V(l,o){if(1&l){const t=e.EpF();e.TgZ(0,"div",11)(1,"form",12),e.NdJ("submit",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.submit())}),e.TgZ(2,"h3"),e._uU(3),e.qZA(),e.TgZ(4,"div",13)(5,"div"),e._uU(6,"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. "),e.qZA(),e.TgZ(7,"button",14),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.edit())}),e.qZA()(),e.TgZ(8,"div",15)(9,"div",16),e._UZ(10,"form-text",17)(11,"val-errors",18),e.qZA(),e.TgZ(12,"div",16),e._UZ(13,"form-text",19),e.qZA()(),e.YNc(14,K,2,1,"div",20),e.TgZ(15,"div",21),e._UZ(16,"form-text",22),e.qZA(),e.TgZ(17,"div",21),e._UZ(18,"form-check",23),e.qZA(),e.TgZ(19,"div",21),e._UZ(20,"form-check",24),e.qZA(),e.YNc(21,X,8,3,"ng-container",25),e.YNc(22,H,3,2,"div",26),e.qZA(),e._UZ(23,"changed-info",27),e.TgZ(24,"pre",28),e._uU(25),e.ALo(26,"json"),e.qZA(),e.TgZ(27,"pre",28),e._uU(28),e.qZA(),e.TgZ(29,"p"),e._uU(30),e.qZA(),e.TgZ(31,"p"),e._uU(32),e.qZA()()}if(2&l){const t=e.oxw(2);e.Akn(e.DdM(19,F)),e.xp6(1),e.Q6J("formGroup",t.form),e.xp6(2),e.Oqu(t.title),e.xp6(7),e.Q6J("disabled",t.isOption||!t.isEditing),e.xp6(3),e.Q6J("disabled",t.isOption||!t.isEditing),e.xp6(1),e.Q6J("ngIf",t.isOption),e.xp6(2),e.Q6J("disabled",!t.isEditing),e.xp6(2),e.Q6J("disabled",!t.isEditing),e.xp6(2),e.Q6J("disabled",!t.isEditing),e.xp6(1),e.Q6J("ngIf",t.def),e.xp6(1),e.Q6J("ngIf",t.isEditing),e.xp6(1),e.Q6J("model",t.model),e.xp6(2),e.Oqu(e.lcZ(26,17,t.form.value)),e.xp6(3),e.hij("Changed: ",t.changed,""),e.xp6(2),e.hij("previous: ",null==t.previousNode?null:t.previousNode.label,""),e.xp6(2),e.hij("selected: ",null==t.selectedNode?null:t.selectedNode.label,"")}}function P(l,o){if(1&l&&e.YNc(0,V,33,20,"div",10),2&l){const t=e.oxw();e.Q6J("ngIf",t.model)}}const W=function(){return[30,70]};let c=class{constructor(o,t,s,i,r,d){this.pyramid=o,this.biz=t,this.store=s,this.fb=i,this.msg=r,this.ns=d,this.profile=null,this.picklists=null,this.nodes=[],this.tree=[],this.selectedNode={},this.previousNode=null,this.lookup=null,this.flatTree=[],this.treeState=[],this.isEditing=!1,this.containerDefs=[],this.isOption=!1,this.model2={},this.def=new Z.a,this.changed=!1,this.task=0,this.isContainer=!1,this.volumeUnits=[0,0],this.rotateIcon="pi pi-angle-double-down",this.rotateText="Expand",this.edit=()=>this.isEditing=!this.isEditing,this.cancel=()=>this.isEditing=!1}ngOnInit(){var o=this;return(0,h.Z)(function*(){o.form=o.fb.group({group:["",[]],picklist:["",[]],option:["",[]],name:["",[]],isEnabled:[null,[]],isItem:[null,[]],wellRows:[null,[]],wellCols:[null,[]],wellVolume:[null,[]]}),o.form.valueChanges.subscribe(t=>{o.changed=!o.compare(o.model,t)}),o.store.picklists$.pipe((0,k.t)(o)).subscribe(t=>{t&&(o.picklists=t,o.saveState(),o.nodes=o.gather(o.picklists.lookups),o.tree=[...o.nodes],o.flatTree=o.flatten(),o.restoreState())}),o.store.profile$.pipe((0,k.t)(o)).subscribe(t=>o.profile=t),o.containerDefs=yield o.pyramid.list("ContainerModels")})()}get title(){const o=this.model._lookup,t=this.model._parent;return t||o?this.isOption?`${t.name} . ${o.name}`:`${this.group} : ${o.name}`:""}get group(){let o=this.isOption?this.model._parent:this.model._lookup;return o.key.includes(":")?o.key.split(":")[0]:""}compare(o,t){let s=!0;return Object.getOwnPropertyNames(o).filter(i=>"_"!=i[0]).forEach(i=>{s&&(s=JSON.stringify(o[i])===JSON.stringify(t[i]))}),s}gather(o,t=0,s=[]){return o.filter(i=>i.parentId===t).sort((i,r)=>i.key<r.key?-1:1).forEach(i=>{const r={data:i,label:i.name,children:[]};s.push(r),this.gather(o,i.id,r.children)}),s}lookupSelect(o){var t=this;return(0,h.Z)(function*(){var s;if(t.selectedNode==t.previousNode)return;if(t.isEditing&&t.changed&&!(yield t.ns.confirm("Discard Changes","There are usaved changes. Do you want to continue?",{acceptText:"Yes"})))return void(t.selectedNode=t.previousNode);t.previousNode=t.selectedNode,t.isEditing=!1;const i=o.node.data,r=t.picklists.lookupById(i.parentId);t.def=t.containerDefs.find(v=>v.containerType===i.id),t.isOption=null!=r;const d=null!==(s=((null==r?void 0:r.key)||i.key).split(":"))&&void 0!==s?s:[null];t.model=[],t.model={_lookup:i,_parent:r,group:d.length>1?d[0]:null,picklist:d[d.length-1],option:r?i.key:null,name:i.name,isItem:i.isItem,isEnabled:i.isEnabled},t.def&&(t.model.wellRows=t.def.wellRows,t.model.wellCols=t.def.wellCols,t.model.wellVolume=[t.def.wellVolume,t.def.unitType]),t.lookup=i,t.form.reset(),t.form.patchValue(t.model),t.changed=!1})()}info(o){this.msg.add({severity:"info",detail:o})}addLookup(o,t=0){this.task=o,this.model=Object.assign(new C.t,{parentId:t,isEnabled:1,isItem:0,clientId:this.profile.clientId,changedBy:this.profile.id,changedOn:(new Date).toISOString()});const s=this.picklists.listById(t);this.isContainer=null==s?void 0:s.key.startsWith("Container"),this.isContainer&&(this.def=new Z.a),this.displayModal=!0}editLookup(o,t){var s;this.task=o;const i=t.data;this.model=Object.assign({},i);const r=null===(s=t.parent)||void 0===s?void 0:s.data;if(this.isContainer=null==r?void 0:r.key.startsWith("Container"),this.isContainer){const d=this.containerDefs.find(v=>v.containerType==i.id);this.def=Object.assign({},d),this.volumeUnits=[null==d?void 0:d.wellVolume,null==d?void 0:d.unitType]}this.displayModal=!0}deleteLookup(o){var t=this;return(0,h.Z)(function*(){(yield t.ns.confirm("Confirm Delete",`Are you sure you want to delete lookup ${o.name}?<br><br>\n      This cannot be undone and any reference to options in this picklist wil be orphaned.`))&&(t.biz.deleteLookup(o),t.info("Option deleted"))})()}printLabel(o){this.info(`Print label for ${o.name}?`)}submit(){var o=this;return(0,h.Z)(function*(){var t,s;o.displayModal=!1;const i=o.model.id;if((s=o.model).name||(s.name=o.model.key),i)yield o.pyramid.put("Lookups",C.t.clean(o.model));else{const r=yield o.pyramid.post("Lookups",C.t.clean(o.model));o.model.id=r.id}if(o.isContainer){if(o.def.wellVolume=o.volumeUnits[0],o.def.unitType=o.volumeUnits[1],null!==(t=o.def)&&void 0!==t&&t.id)yield o.pyramid.put("ContainerModels",o.def);else{o.def.containerType=o.model.id;const r=yield o.pyramid.post("ContainerModels",o.def);o.def.id=r.id}o.containerDefs=yield o.pyramid.list("ContainerModels")}o.info("Lookup updated"),o.biz.loadPicklists()})()}expandAll(){this.tree.forEach(o=>{this.expandRecursive(o,!0)})}collapseAll(){this.tree.forEach(o=>{this.expandRecursive(o,!1)})}expandRecursive(o,t){o.expanded=t,o.children&&o.children.forEach(s=>{this.expandRecursive(s,t)})}flatten(o=null,t=[]){return o||(o=this.nodes),o.filter(s=>{var i;return(null===(i=s.children)||void 0===i?void 0:i.length)>0}).forEach(s=>{t.push(s),this.flatten(s.children,t)}),t}rotateState(){"Expand"==this.rotateText?(this.saveState(),this.traverse(!0)):"Collapse"==this.rotateText?this.traverse(!1):this.restoreState()}traverse(o){this.flatTree.forEach(t=>t.expanded=o),this.tree=[...this.nodes],this.updateRotate()}saveState(){this.treeState=this.flatTree.filter(o=>{var t;return(null===(t=o.children)||void 0===t?void 0:t.length)>0&&o.expanded}).map(o=>o.data.id)}restoreState(){this.flatTree.forEach(o=>o.expanded=this.treeState.includes(o.data.id)),this.tree=[...this.nodes],this.updateRotate()}nodeExpand(o){this.updateRotate()}nodeCollapse(o){this.updateRotate()}updateRotate(){const o=this.flatTree.filter(t=>t.expanded).length;o==this.flatTree.length?(this.rotateText="Collapse",this.rotateIcon="pi pi-angle-double-up"):0==o&&this.treeState.length>0?(this.rotateText="Restore",this.rotateIcon="pi pi-share-alt"):(this.rotateText="Expand",this.rotateIcon="pi pi-angle-double-down")}accept(){}};c.\u0275fac=function(o){return new(o||c)(e.Y36(_.tG),e.Y36(_.Kc),e.Y36(O.d),e.Y36(u.QS),e.Y36(y.ez),e.Y36(p.c))},c.\u0275cmp=e.Xpm({type:c,selectors:[["lookups"]],viewQuery:function(o,t){if(1&o&&e.Gf(I.iw,5),2&o){let s;e.iGM(s=e.CRH())&&(t.tt=s.first)}},features:[e._Bn([y.ez])],decls:5,vars:2,consts:[[1,"flex-wrapper"],["styleClass","h-full",1,"h-full",3,"panelSizes"],["pTemplate",""],[1,"w-full","flex","flex-column"],[1,"card","mb-0","p-2","flex","gap-1"],["pButton","","pRipple","","type","button","icon","pi pi-angle-double-down",1,"p-button-rounded","p-button-text",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-angle-double-up",1,"p-button-rounded","p-button-text",3,"click"],["pButton","","type","button","label","picklist","icon","pi pi-plus",1,"ml-auto","p-button-text","p-button-sm"],["pButton","","type","button","label","option","icon","pi pi-plus",1,"p-button-text","p-button-sm",3,"disabled"],["scrollHeight","flex","selectionMode","single",1,"overflow-y-auto",3,"value","selection","filter","selectionChange","onNodeSelect"],["class","card overflow-y-auto",3,"style",4,"ngIf"],[1,"card","overflow-y-auto"],[3,"formGroup","submit"],[1,"field","flex"],["pButton","","type","button","label","edit","icon","pi pi-pencil",1,"ml-auto","p-button-text","p-button-sm",3,"click"],[1,"grid"],[1,"field","col","mb-0"],["label","Group Key","formControlName","group",3,"disabled"],["controlName","name","label","The group"],["label","Picklist Key","prompt","key","formControlName","picklist",3,"disabled"],["class","field",4,"ngIf"],[1,"field"],["label","Display Name","formControlName","name",3,"disabled"],["label","Enabled","formControlName","isEnabled",3,"disabled"],["label","Item","formControlName","isItem",3,"disabled"],[4,"ngIf"],["class","flex justify-content-end align-items-center p-2",4,"ngIf"],[3,"model"],[1,"m-2","p-2","text-sm","bg-yellow-50"],["label","Option Key","formControlName","option",3,"disabled"],[1,"field","col","pb-0","mb-0"],["label","Number of Rows","formControlName","wellRows",3,"disabled"],["label","Number of Columns","formControlName","wellCols",3,"disabled"],[1,"field","col"],["formControlName","wellVolume","label","Well Volume","decimals","3","units","Units:Volume",3,"disabled"],[1,"flex","justify-content-end","align-items-center","p-2"],["pButton","","pRipple","","type","button","label","Cancel",1,"p-button-text","mr-2",3,"click"],["label","Save",3,"disabled","click"]],template:function(o,t){1&o&&(e._UZ(0,"p-toast"),e.TgZ(1,"div",0)(2,"p-splitter",1),e.YNc(3,D,7,4,"ng-template",2),e.YNc(4,P,1,1,"ng-template",2),e.qZA()()),2&o&&(e.xp6(2),e.Q6J("panelSizes",e.DdM(1,W)))},dependencies:[m.O5,u._Y,u.JJ,u.JL,u.sg,u.u,y.jx,M.Hq,M.zx,S.q,U.FN,j.mp,Q.tM,$.a,Y.F,z.Z,G.Y,m.Ts],styles:[".col[_ngcontent-%COMP%]{margin:0}.animate[_ngcontent-%COMP%]{animation-duration:.5s;animation-name:animate-fade;animation-fill-mode:backwards}@keyframes animate-fade{0%{opacity:0}to{opacity:1}}"],data:{animation:[J,(0,n.X$)("grow",[(0,n.eR)(":enter",[(0,n.oB)({height:"0",overflow:"hidden"}),(0,n.jt)(500,(0,n.oB)({height:"*"}))]),(0,n.eR)(":leave",[(0,n.jt)(500,(0,n.oB)({height:0,overflow:"hidden"}))])]),(0,n.X$)("fade",[(0,n.eR)(":enter",[(0,n.oB)({opacity:0}),(0,n.jt)(250,(0,n.oB)({opacity:1}))]),(0,n.eR)(":leave",[(0,n.jt)(250,(0,n.oB)({opacity:0}))])])]}}),c=(0,B.gn)([(0,k.c)()],c);var q=a(5330);const ee=[{path:"",component:c,canActivate:[x.a1]}];let te=(()=>{class l{}return l.\u0275fac=function(t){return new(t||l)},l.\u0275mod=e.oAB({type:l}),l.\u0275inj=e.cJS({providers:[p.c,q.xA],imports:[m.ez,b.Bz.forChild(ee),A.m,T.R,p.S8,p.zY,p.Gv,p.yn,p.cB,p.NY]}),l})()}}]);