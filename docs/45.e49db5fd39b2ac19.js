"use strict";(self.webpackChunkpyramid=self.webpackChunkpyramid||[]).push([[45],{7374:(Y,u,l)=>{l.r(u),l.d(u,{EditDataModule:()=>B});var f=l(9808),v=l(6037),p=l(9600),b=l(7577),C=l(9028),y=l(4499),r=l(5861),T=l(655),c=l(4987),E=l(1135),d=l(2382),N=l(3120),h=l(9783),t=l(5e3),m=l(1528),g=l(845),Z=l(4119),w=l(5315),D=l(9748),J=l(4534),A=l(9711);function M(s,e){1&s&&(t.TgZ(0,"div"),t._uU(1,"Edit table record"),t.qZA())}function R(s,e){if(1&s){const o=t.EpF();t.TgZ(0,"form",9),t.NdJ("ngSubmit",function(){t.CHM(o);const i=t.oxw();return t.KtG(i.submit())}),t._UZ(1,"formly-form",10),t.qZA(),t.TgZ(2,"div"),t._uU(3),t.ALo(4,"json"),t.qZA()}if(2&s){const o=t.oxw();t.Q6J("formGroup",o.form),t.xp6(1),t.Q6J("model",o.model)("fields",o.fields)("form",o.form)("options",o.options),t.xp6(2),t.Oqu(t.lcZ(4,6,o.fields))}}function x(s,e){if(1&s){const o=t.EpF();t.TgZ(0,"p-button",11),t.NdJ("click",function(){t.CHM(o);const i=t.oxw();return t.KtG(i.displayModal=!1)}),t.qZA(),t.TgZ(1,"p-button",12),t.NdJ("click",function(){t.CHM(o);const i=t.oxw();return t.KtG(i.submit())}),t.qZA()}}const $=function(){return{width:"50vw","max-width":"600px"}};let a=class{constructor(e,o,n,i){this.pyramid=e,this.ns=o,this.store=n,this.broadcast=i,this.tables$=new E.X([]),this.table="",this.tables=[],this.tableName="",this.paint=N.Kf,this.colNames=[],this.cols=[],this.rows=[],this.clients=[],this.users=[],this.config=[],this.form=new d.nJ({}),this.model={},this.displayModal=!1}ngOnInit(){this.store.picklists$.pipe((0,c.t)(this)).subscribe(e=>this.picklists=e),this.tables$.pipe((0,c.t)(this)).subscribe(e=>this.tables=e.map(o=>({name:o,value:o}))),this.store.users$.pipe((0,c.t)(this)).subscribe(e=>this.users=e),this.broadcast.listen("fk").subscribe(e=>{console.log(`Selected row id = ${e}`)}),this.refresh()}refresh(){var e=this;return(0,r.Z)(function*(){e.clients=yield e.pyramid.list("Clients");const o=yield e.pyramid.tables();e.tables$.next(o)})()}selectTable(e){var o=this;return(0,r.Z)(function*(){o.tableName=e.name,o.colNames=yield o.pyramid.tableColumns(e.name),console.log(o.colNames),o.cols=[{type:"icon",field:"icon_edit",icon:"edit",wd:50,click:(n,i)=>o.onAction(n,i)},...o.colNames.map(n=>({field:n,header:n})),{type:"icon",field:"icon_delete",icon:"delete",wd:50,click:(n,i)=>o.onAction(n,i)}],o.cols.forEach(n=>{"id"==n.field&&(n.wd=75),"changedBy"==n.field&&(n.wd=100)}),o.rows=yield o.pyramid.list(e.name)})()}onClick(e,o,n){console.log(`PARENT CLICK: ${n.property}`)}onRowClick(e){console.log("CLICK: "+e.id)}onAction(e,o){var n=this;return(0,r.Z)(function*(){if("edit"===e){n.model=Object.assign({},o);const i=yield n.ns.formly(`Edit ${n.tableName} Record`,null,n.model);i&&n.ns.showJson("Row",i)}else"delete"===e&&(yield n.ns.confirm("Delete Row",`Do you really want to delete row ${o.id}?`))&&(yield n.ns.message("Row deleted"))})()}submit(){var e=this;return(0,r.Z)(function*(){e.ns.showJson("Row",e.model)})()}clientByUser(e){var o,n;return null!==(n=null===(o=this.clients.find(i=>i.id==e.id))||void 0===o?void 0:o.name)&&void 0!==n?n:"-"}onSelect(e){console.log(`PARENT SELECT: ++${e.added.length} --${e.removed.length}`)}onRowClicked(e){console.log(`PARENT ROW: ${e.text}`)}onProcess(e){console.log(`Process ${e}`)}addRecord(){var e=this;return(0,r.Z)(function*(){e.model={};const o=yield e.ns.formly(`New ${e.tableName} Record`,null,e.model,e.config);if(o){e.ns.showJson("Row",o);const n=e.pyramid.post(e.tableName,o);e.model.id=n.id,e.rows=[...e.rows,o]}})()}showJson(e){return JSON.stringify(e,null,2)}};a.\u0275fac=function(e){return new(e||a)(t.Y36(m.tG),t.Y36(p.c),t.Y36(m.d6),t.Y36(m.Mr))},a.\u0275cmp=t.Xpm({type:a,selectors:[["edit-data"]],features:[t._Bn([h.ez])],decls:10,vars:11,consts:[[3,"visible","modal","draggable","resizable","visibleChange"],["pTemplate","header"],["pTemplate","content"],["pTemplate","footer"],[1,"flex-auto","flex","flex-column","overflow-y-hidden"],[1,"p-0","flex-auto","overflow-y-auto"],["placeholder","Select a Table","optionLabel","name",3,"options","ngModel","ngModelChange","onChange"],["pButton","","pRipple","","type","button","icon","pi pi-plus","pTooltip","New Record","tooltipPosition","left",1,"ml-auto","p-button-rounded",3,"click"],[1,"flex-auto",3,"cols","value","click"],["overflow-y-auto","",1,"p-mb-4",3,"formGroup","ngSubmit"],[3,"model","fields","form","options"],["icon","pi pi-times","label","CANCEL","styleClass","p-button-text",3,"click"],["icon","pi pi-check","label","SUBMIT",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"p-dialog",0),t.NdJ("visibleChange",function(i){return o.displayModal=i}),t.YNc(1,M,2,0,"ng-template",1),t.YNc(2,R,5,8,"ng-template",2),t.YNc(3,x,2,0,"ng-template",3),t.qZA(),t.TgZ(4,"div",4)(5,"div",5)(6,"p-toolbar")(7,"p-dropdown",6),t.NdJ("ngModelChange",function(i){return o.table=i})("onChange",function(i){return o.selectTable(i.value)}),t.qZA(),t.TgZ(8,"button",7),t.NdJ("click",function(){return o.addRecord()}),t.qZA()(),t.TgZ(9,"tbl",8),t.NdJ("click",function(i){return o.onRowClick(i)}),t.qZA()()()),2&e&&(t.Akn(t.DdM(10,$)),t.Q6J("visible",o.displayModal)("modal",!0)("draggable",!0)("resizable",!1),t.xp6(7),t.Q6J("options",o.tables)("ngModel",o.table),t.xp6(2),t.Q6J("cols",o.cols)("value",o.rows))},dependencies:[d._Y,d.JJ,d.JL,d.On,d.sg,h.jx,g.Hq,g.zx,Z.u,w.V,D.Lt,J.o,A.$,f.Ts]}),a=(0,T.gn)([(0,c.c)()],a);const S=[{path:"",component:a,canActivate:[C.a1]}];let B=(()=>{class s{}return s.\u0275fac=function(o){return new(o||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[f.ez,y.m,v.Bz.forChild(S),p.cB,p.NY,b.R]}),s})()}}]);