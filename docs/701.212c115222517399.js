"use strict";(self.webpackChunkpyramid=self.webpackChunkpyramid||[]).push([[701],{3482:(y,u,s)=>{s.d(u,{a:()=>_});var p=s(1169);let _=(()=>{class d extends p.e{constructor(g){super(),Object.assign(this,g)}}return d.tableName="ContainerModels",d})()},1701:(y,u,s)=>{s.r(u),s.d(u,{LookupsModule:()=>pe});var p=s(9808),_=s(6037),d=s(9600),v=s(7577),g=s(9028),L=s(4499),h=s(5861),N=s(655),f=s(9783),M=s(3482),x=s(6264),C=s(4987),m=s(9544),e=s(5e3),b=s(1528),w=s(2e3),T=s(2382),Z=s(845),J=s(1208),S=s(330),A=s(4119),E=s(5315),Q=s(1424),I=s(7773),K=s(1435),G=s(2501),U=s(5949),Y=s(8821),H=s(3019),D=s(9165),O=s(7329);function R(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"dialog-header",7),e.NdJ("close",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.displayModal=!1)}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("title",t.taskText())}}function V(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",19)(1,"form-select",20),e.NdJ("ngModelChange",function(n){e.CHM(t);const a=e.oxw(2);return e.KtG(a.model.roleType=n)}),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngModel",t.model.roleType)}}function F(i,o){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",15)(2,"form-number",21),e.NdJ("ngModelChange",function(n){e.CHM(t);const a=e.oxw(2);return e.KtG(a.def.wellRows=n)}),e.qZA()(),e.TgZ(3,"div",15)(4,"form-number",22),e.NdJ("ngModelChange",function(n){e.CHM(t);const a=e.oxw(2);return e.KtG(a.def.wellCols=n)}),e.qZA()(),e.TgZ(5,"div",15)(6,"form-number",23),e.NdJ("ngModelChange",function(n){e.CHM(t);const a=e.oxw(2);return e.KtG(a.volumeUnits=n)}),e.qZA()(),e.TgZ(7,"div",15)(8,"form-select",24),e.NdJ("ngModelChange",function(n){e.CHM(t);const a=e.oxw(2);return e.KtG(a.def.wellShapeType=n)}),e.qZA()(),e.TgZ(9,"div",25),e._uU(10),e.ALo(11,"json"),e.qZA(),e.BQk()}if(2&i){const t=e.oxw(2);e.xp6(2),e.Q6J("ngModel",t.def.wellRows),e.xp6(2),e.Q6J("ngModel",t.def.wellCols),e.xp6(2),e.Q6J("ngModel",t.volumeUnits),e.xp6(2),e.Q6J("ngModel",t.def.wellShapeType),e.xp6(2),e.Oqu(e.lcZ(11,5,t.def))}}function $(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",8)(1,"div",9)(2,"form-text",10,11),e.NdJ("ngModelChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.model.key=n)}),e.qZA(),e._UZ(4,"val-errors",12),e.qZA(),e.TgZ(5,"div",9)(6,"form-text",13),e.NdJ("ngModelChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.model.name=n)}),e.qZA()(),e.YNc(7,V,2,1,"div",14),e.TgZ(8,"div",15)(9,"p-checkbox",16),e.NdJ("ngModelChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.model.isItem=n)}),e.qZA()(),e.TgZ(10,"div",15)(11,"p-checkbox",17),e.NdJ("ngModelChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.model.isEnabled=n)}),e.qZA()(),e.YNc(12,F,12,7,"ng-container",18),e.qZA(),e._UZ(13,"changed-info",4)}if(2&i){const t=e.MAs(3),l=e.oxw();e.xp6(2),e.Q6J("ngModel",l.model.key),e.xp6(2),e.Q6J("control",t.control),e.xp6(2),e.Q6J("ngModel",l.model.name),e.xp6(1),e.Q6J("ngIf",!l.model.parentId),e.xp6(2),e.Q6J("falseValue",0)("trueValue",1)("ngModel",l.model.isItem),e.xp6(2),e.Q6J("falseValue",0)("trueValue",1)("ngModel",l.model.isEnabled),e.xp6(1),e.Q6J("ngIf",l.isContainer),e.xp6(1),e.Q6J("model",l.model)}}function j(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"dialog-footer",26),e.NdJ("reject",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.displayModal=!1)})("accept",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.submit())}),e.qZA()}}function B(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",32)(1,"span",33),e._UZ(2,"i",34),e.TgZ(3,"input",35,36),e.NdJ("mouseup",function(n){return n.target.select()})("input",function(n){e.CHM(t),e.oxw();const a=e.MAs(1);return e.KtG(a.filterGlobal(n.target.value,"contains"))}),e.qZA()(),e.TgZ(5,"button",37),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.rotateState())}),e.qZA(),e.TgZ(6,"button",38),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.addLookup(1))}),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(3),e.Q6J("showClear",!0),e.xp6(2),e.Q6J("label",t.rotateText)("icon",t.rotateIcon)}}function z(i,o){if(1&i&&(e.TgZ(0,"th"),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.Udp("width",t.wd,"px"),e.xp6(1),e.hij(" ",t.header," ")}}function P(i,o){if(1&i&&(e.TgZ(0,"tr"),e.YNc(1,z,2,3,"th",39),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.Q6J("ngForOf",t)}}function W(i,o){if(1&i&&(e.ynx(0),e._UZ(1,"p-treeTableToggler",45),e._uU(2),e.BQk()),2&i){const t=e.oxw(2),l=t.$implicit,n=t.rowData;e.xp6(1),e.Q6J("rowNode",l),e.xp6(1),e.hij(" ",n.key," ")}}const k=function(i){return{"pi pi-check":i}};function X(i,o){if(1&i&&e._UZ(0,"i",46),2&i){const t=e.oxw(2).rowData;e.Q6J("ngClass",e.VKq(1,k,t.isItem))}}function q(i,o){if(1&i&&e._UZ(0,"i",46),2&i){const t=e.oxw(2).rowData;e.Q6J("ngClass",e.VKq(1,k,t.isEnabled))}}function ee(i,o){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw(2).rowData,l=e.oxw(2);let n;e.xp6(1),e.Oqu(t.parentId?"":null!==(n=l.picklists.name[t.roleType])&&void 0!==n?n:"-")}}function te(i,o){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit,l=e.oxw().rowData;e.xp6(1),e.Oqu(l[t.field])}}function oe(i,o){if(1&i&&(e.TgZ(0,"td")(1,"container-element",41),e.YNc(2,W,3,2,"ng-container",42),e.YNc(3,X,1,3,"i",43),e.YNc(4,q,1,3,"i",43),e.YNc(5,ee,2,1,"span",42),e.YNc(6,te,2,1,"span",44),e.qZA()()),2&i){const t=o.$implicit;e.Udp("width",t.wd,"px"),e.xp6(1),e.Q6J("ngSwitch",t.field),e.xp6(1),e.Q6J("ngSwitchCase","key"),e.xp6(1),e.Q6J("ngSwitchCase","isItem"),e.xp6(1),e.Q6J("ngSwitchCase","isEnabled"),e.xp6(1),e.Q6J("ngSwitchCase","roleType")}}function ne(i,o){if(1&i&&(e.TgZ(0,"tr",40),e.YNc(1,oe,7,7,"td",39),e.qZA()),2&i){const t=o.$implicit,l=o.columns;e.Q6J("ttContextMenuRow",t)("ttRow",t),e.xp6(1),e.Q6J("ngForOf",l)}}function le(i,o){if(1&i&&(e.TgZ(0,"tr")(1,"td"),e._uU(2,"No lookups to display"),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(1),e.uIk("colspan",t.cols.length)}}function ie(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"p-treeTable",27,28),e.NdJ("onContextMenuSelect",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.setContextMenu(n.node))})("contextMenuSelectionChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.selectedNode=n)})("onNodeSelect",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.nodeSelect(n.node))})("onNodeExpand",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.nodeExpand(n.node))})("onNodeCollapse",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.nodeCollapse(n.node))}),e.YNc(2,B,7,3,"ng-template",29),e.YNc(3,P,2,1,"ng-template",1),e.YNc(4,ne,2,3,"ng-template",30),e.YNc(5,le,3,1,"ng-template",31),e.qZA()}if(2&i){const t=e.oxw(),l=e.MAs(6);e.Q6J("value",t.tree)("columns",t.cols)("scrollable",!0)("contextMenuSelection",t.selectedNode)("contextMenu",l)("autoLayout",!0)}}const ae=function(){return{width:"50vw","max-width":"600px"}};let r=class{constructor(o,t,l,n,a){this.pyramid=o,this.biz=t,this.store=l,this.msg=n,this.ns=a,this.profile=null,this.picklists=null,this.nodes=[],this.tree=[],this.selectedNode={},this.flatTree=[],this.treeState=[],this.containerDefs=[],this.def=new M.a,this.task=0,this.isContainer=!1,this.volumeUnits=[0,0],this.rotateIcon="pi pi-angle-double-down",this.rotateText="Expand"}ngOnInit(){var o=this;return(0,h.Z)(function*(){o.cols=[{field:"key",header:"Key"},{field:"id",header:"Id",wd:75},{field:"name",header:"Name"},{field:"isItem",header:"Item",wd:75},{field:"isEnabled",header:"Enabled",wd:75},{field:"roleType",header:"Role",wd:100}],o.store.picklists$.pipe((0,C.t)(o)).subscribe(t=>{t&&(o.picklists=t,o.saveState(),o.nodes=o.gather(o.picklists.lookups),o.tree=[...o.nodes],o.flatTree=o.flatten(),o.restoreState())}),o.store.profile$.pipe((0,C.t)(o)).subscribe(t=>o.profile=t),o.containerDefs=yield o.pyramid.list("ContainerModels")})()}taskText(){var o,t,l,n,a;return 1==this.task?"Add Picklist":2==this.task?`Add Option to PickList ${null===(o=this.selectedNode)||void 0===o?void 0:o.data.name} (${null===(l=null===(t=this.selectedNode)||void 0===t?void 0:t.data)||void 0===l?void 0:l.id})`:3==this.task?`Edit Picklist (${null===(n=this.model)||void 0===n?void 0:n.id})`:4==this.task?`Edit Option (${null===(a=this.model)||void 0===a?void 0:a.id})`:"Picklists & Options"}gather(o,t=0,l=[]){return o.filter(n=>n.parentId===t).sort((n,a)=>n.key<a.key?-1:1).forEach(n=>{const a={data:n,label:n.name,children:[]};l.push(a),this.gather(o,n.id,a.children)}),l}info(o){this.msg.add({severity:"info",detail:o})}setContextMenu(o){this.items=this.tree.includes(o)?[{label:"Edit",icon:"pi pi-pencil",command:t=>this.editLookup(3,this.selectedNode)},{label:"Delete",icon:"pi pi-trash",command:t=>this.deleteLookup(this.selectedNode.data)},{label:"Add Option",icon:"pi pi-plus-circle",command:t=>this.addLookup(2,this.selectedNode.data.id)}]:[{label:"Edit",icon:"pi pi-pencil",command:t=>this.editLookup(4,this.selectedNode)},{label:"Delete",icon:"pi pi-trash",command:t=>this.deleteLookup(this.selectedNode.data)},{label:"Print Label",icon:"pi pi-print",command:t=>this.printLabel(this.selectedNode.data)}]}addLookup(o,t=0){this.task=o,this.model=Object.assign(new x.t,{parentId:t,isEnabled:1,isItem:0,clientId:this.profile.clientId,changedBy:this.profile.id,changedOn:(new Date).toISOString()});const l=this.picklists.listById(t);this.isContainer=null==l?void 0:l.key.startsWith("Container"),this.isContainer&&(this.def=new M.a),this.displayModal=!0}editLookup(o,t){var l;this.task=o;const n=t.data;this.model=Object.assign({},n);const a=null===(l=t.parent)||void 0===l?void 0:l.data;if(this.isContainer=null==a?void 0:a.key.startsWith("Container"),this.isContainer){const c=this.containerDefs.find(de=>de.containerType==n.id);this.def=Object.assign({},c),this.volumeUnits=[null==c?void 0:c.wellVolume,null==c?void 0:c.unitType]}this.displayModal=!0}deleteLookup(o){var t=this;return(0,h.Z)(function*(){(yield t.ns.confirm("Confirm Delete",`Are you sure you want to delete lookup ${o.name}?<br><br>\n      This cannot be undone and any reference to options in this picklist wil be orphaned.`))&&(t.biz.deleteLookup(o),t.info("Option deleted"))})()}printLabel(o){this.info(`Print label for ${o.name}?`)}submit(){var o=this;return(0,h.Z)(function*(){var t,l;o.displayModal=!1;const n=o.model.id;if((l=o.model).name||(l.name=o.model.key),n)yield o.pyramid.put("Lookups",x.t.clean(o.model));else{const a=yield o.pyramid.post("Lookups",x.t.clean(o.model));o.model.id=a.id}if(o.isContainer){if(o.def.wellVolume=o.volumeUnits[0],o.def.unitType=o.volumeUnits[1],null!==(t=o.def)&&void 0!==t&&t.id)yield o.pyramid.put("ContainerModels",o.def);else{o.def.containerType=o.model.id;const a=yield o.pyramid.post("ContainerModels",o.def);o.def.id=a.id}o.containerDefs=yield o.pyramid.list("ContainerModels")}o.info("Lookup updated"),o.biz.loadPicklists()})()}nodeSelect(o){this.displayModal=!0,alert("SELECT")}flatten(o=null,t=[]){return o||(o=this.nodes),o.filter(l=>{var n;return(null===(n=l.children)||void 0===n?void 0:n.length)>0}).forEach(l=>{t.push(l),this.flatten(l.children,t)}),t}rotateState(){"Expand"==this.rotateText?(this.saveState(),this.traverse(!0)):"Collapse"==this.rotateText?this.traverse(!1):this.restoreState()}traverse(o){this.flatTree.forEach(t=>t.expanded=o),this.tree=[...this.nodes],this.updateRotate()}saveState(){this.treeState=this.flatTree.filter(o=>{var t;return(null===(t=o.children)||void 0===t?void 0:t.length)>0&&o.expanded}).map(o=>o.data.id)}restoreState(){this.flatTree.forEach(o=>o.expanded=this.treeState.includes(o.data.id)),this.tree=[...this.nodes],this.updateRotate()}nodeExpand(o){this.updateRotate()}nodeCollapse(o){this.updateRotate()}updateRotate(){const o=this.flatTree.filter(t=>t.expanded).length;o==this.flatTree.length?(this.rotateText="Collapse",this.rotateIcon="pi pi-angle-double-up"):0==o&&this.treeState.length>0?(this.rotateText="Restore",this.rotateIcon="pi pi-share-alt"):(this.rotateText="Expand",this.rotateIcon="pi pi-angle-double-down")}};r.\u0275fac=function(o){return new(o||r)(e.Y36(b.tG),e.Y36(b.Kc),e.Y36(w.d),e.Y36(f.ez),e.Y36(d.c))},r.\u0275cmp=e.Xpm({type:r,selectors:[["lookups"]],viewQuery:function(o,t){if(1&o&&e.Gf(m.iw,5),2&o){let l;e.iGM(l=e.CRH())&&(t.tt=l.first)}},features:[e._Bn([f.ez])],decls:8,vars:9,consts:[[3,"visible","modal","draggable","resizable","visibleChange"],["pTemplate","header"],["pTemplate","content"],["pTemplate","footer"],[3,"model"],["cm",""],["selectionMode","single","dataKey","key","scrollHeight","flex","styleClass","p-treetable-sm",3,"value","columns","scrollable","contextMenuSelection","contextMenu","autoLayout","onContextMenuSelect","contextMenuSelectionChange","onNodeSelect","onNodeExpand","onNodeCollapse",4,"ngIf"],["icon","pencil",3,"title","close"],[1,"formgrid","grid","p-2"],[1,"field","col-6","mt-2"],["label","Key","required","true",3,"ngModel","ngModelChange"],["ctrl","ngModel"],["label","The key",3,"control"],["label","Name",3,"ngModel","ngModelChange"],["class","field col-12 mt-3",4,"ngIf"],[1,"field","col-12","md:col-6","mt-2"],["name","tangible","binary","false","label","Item",3,"falseValue","trueValue","ngModel","ngModelChange"],["name","enabled","binary","false","label","Enabled",3,"falseValue","trueValue","ngModel","ngModelChange"],[4,"ngIf"],[1,"field","col-12","mt-3"],["label","Access Role","picklist","Role",3,"ngModel","ngModelChange"],["label","Number of Rows",3,"ngModel","ngModelChange"],["label","Number of Columns",3,"ngModel","ngModelChange"],["label","Well Volume","decimals","3","units","Units.Volume",3,"ngModel","ngModelChange"],["label","Well shape","picklist","WellShape",3,"ngModel","ngModelChange"],[1,"m-2","p-2","text-sm","bg-yellow-50"],["acceptText","SUBMIT",3,"reject","accept"],["selectionMode","single","dataKey","key","scrollHeight","flex","styleClass","p-treetable-sm",3,"value","columns","scrollable","contextMenuSelection","contextMenu","autoLayout","onContextMenuSelect","contextMenuSelectionChange","onNodeSelect","onNodeExpand","onNodeCollapse"],["tt",""],["pTemplate","caption"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"flex","align-items-center"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["type","text","pInputText","","size","20","placeholder","Search",2,"width","auto",3,"showClear","mouseup","input"],["search",""],["pButton","","pRipple","","type","button",1,"ml-2","p-button-text","p-button-secondary","p-button-sm",3,"label","icon","click"],["pButton","","pRipple","","type","button","icon","pi pi-plus","pTooltip","New Picklist","tooltipPosition","left",1,"ml-auto","p-button-rounded",3,"click"],[3,"width",4,"ngFor","ngForOf"],[3,"ttContextMenuRow","ttRow"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"ngClass",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"rowNode"],[3,"ngClass"]],template:function(o,t){1&o&&(e._UZ(0,"p-toast"),e.TgZ(1,"p-dialog",0),e.NdJ("visibleChange",function(n){return t.displayModal=n}),e.YNc(2,R,1,1,"ng-template",1),e.YNc(3,$,14,12,"ng-template",2),e.YNc(4,j,1,0,"ng-template",3),e.qZA(),e._UZ(5,"p-contextMenu",4,5),e.YNc(7,ie,6,6,"p-treeTable",6)),2&o&&(e.xp6(1),e.Akn(e.DdM(8,ae)),e.Q6J("visible",t.displayModal)("modal",!0)("draggable",!0)("resizable",!1),e.xp6(4),e.Q6J("model",t.items),e.xp6(2),e.Q6J("ngIf",!0))},dependencies:[p.mk,p.sg,p.O5,p.RF,p.n9,p.ED,T.JJ,T.Q7,T.On,f.jx,Z.Hq,J.XZ,S.xV,A.u,E.V,Q.o,I.FN,m.iw,m.gc,m.V4,m.NQ,K.tM,G.g,U.A,Y.a,H.Z,D.o,O.Y,p.Ts]}),r=(0,N.gn)([(0,C.c)()],r);const se=[{path:"",component:r,canActivate:[g.a1]}];let pe=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[p.ez,_.Bz.forChild(se),L.m,v.R,d.S8,d.zY,d.Gv,d.yn,d.cB,d.NY]}),i})()}}]);