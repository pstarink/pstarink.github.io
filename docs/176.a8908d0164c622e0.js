"use strict";(self.webpackChunkpyramid=self.webpackChunkpyramid||[]).push([[176],{8176:(it,_,l)=>{l.r(_),l.d(_,{StorageModule:()=>at});var x=l(6037),c=l(9600),C=l(7577),T=l(9028),S=l(4499),g=l(5861),b=l(655),u=l(9783),v=l(5188),M=l(1135),m=l(4987),d=l(9544),t=l(5e3),y=l(1528),N=l(2e3),p=l(9808),h=l(2382),Z=l(845),w=l(1208),J=l(330),A=l(4119),E=l(5315),L=l(1424),Q=l(7773),Y=l(2501),F=l(5949),G=l(8821),R=l(9165),D=l(7329);function H(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"dialog-header",11),t.NdJ("close",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.displayModal=!1)}),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("title",e.taskText())}}function I(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",12)(1,"div",13)(2,"form-text",14),t.NdJ("ngModelChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.model.name=a)}),t.qZA()(),t.TgZ(3,"div",13)(4,"form-select",15),t.NdJ("ngModelChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.model.locationType=a)}),t.qZA()(),t.TgZ(5,"div",13)(6,"form-text",16),t.NdJ("ngModelChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.model.layout=a)}),t.qZA()(),t.TgZ(7,"div",13)(8,"form-text",17),t.NdJ("ngModelChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.model.description=a)}),t.qZA()(),t.TgZ(9,"div",13)(10,"p-checkbox",18),t.NdJ("ngModelChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.model.isFixed=a)}),t.qZA()(),t.TgZ(11,"div",13)(12,"p-checkbox",19),t.NdJ("ngModelChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.model.isEnabled=a)}),t.qZA()()(),t._UZ(13,"changed-info",4)}if(2&n){const e=t.oxw();t.xp6(2),t.Q6J("ngModel",e.model.name),t.xp6(2),t.Q6J("ngModel",e.model.locationType),t.xp6(2),t.Q6J("ngModel",e.model.layout),t.xp6(2),t.Q6J("ngModel",e.model.description),t.xp6(2),t.Q6J("falseValue",0)("trueValue",1)("ngModel",e.model.isFixed),t.xp6(2),t.Q6J("falseValue",0)("trueValue",1)("ngModel",e.model.isEnabled),t.xp6(1),t.Q6J("model",e.model)}}function K(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"dialog-footer",20),t.NdJ("reject",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.displayModal=!1)})("accept",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.submit())}),t.qZA()}}function $(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",30),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.unScope())}),t.qZA()}}function k(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",21)(1,"span",22),t._UZ(2,"i",23),t.TgZ(3,"input",24,25),t.NdJ("mouseup",function(a){return a.target.select()})("input",function(a){t.CHM(e),t.oxw();const s=t.MAs(8);return t.KtG(s.filterGlobal(a.target.value,"contains"))}),t.qZA()(),t.TgZ(5,"button",26),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.rotateState())}),t.qZA(),t.TgZ(6,"button",27),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.level2())}),t.qZA(),t.YNc(7,$,1,0,"button",28),t.TgZ(8,"button",29),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.addLocation(1))}),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("showClear",!0),t.xp6(2),t.Q6J("label",e.rotateText)("icon",e.rotateIcon),t.xp6(2),t.Q6J("ngIf",e.scoped)}}function U(n,o){if(1&n&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Udp("width",e.wd,"px"),t.xp6(1),t.hij(" ",e.header," ")}}function B(n,o){if(1&n&&(t.TgZ(0,"tr"),t.YNc(1,U,2,3,"th",31),t.qZA()),2&n){const e=o.$implicit;t.xp6(1),t.Q6J("ngForOf",e)}}function V(n,o){if(1&n&&t._UZ(0,"p-treeTableToggler",39),2&n){const e=t.oxw(3).$implicit;t.Q6J("rowNode",e)}}function O(n,o){if(1&n&&(t.ynx(0),t.YNc(1,V,1,1,"p-treeTableToggler",38),t._uU(2),t.BQk()),2&n){const e=t.oxw().index,i=t.oxw().rowData;t.xp6(1),t.Q6J("ngIf",0===e),t.xp6(1),t.hij(" ",i.name," ")}}function j(n,o){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2).rowData,i=t.oxw();t.xp6(1),t.Oqu(i.picklists.name[e.locationType])}}const f=function(n){return{"pi pi-check":n}};function z(n,o){if(1&n&&t._UZ(0,"i",40),2&n){const e=t.oxw(2).rowData;t.Q6J("ngClass",t.VKq(1,f,e.isFixed))}}function P(n,o){if(1&n&&t._UZ(0,"i",40),2&n){const e=t.oxw(2).rowData;t.Q6J("ngClass",t.VKq(1,f,e.isEnabled))}}function X(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"i",41),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2).$implicit,s=t.oxw();return t.KtG(s.editNotes(a.node))}),t.qZA()}}function W(n,o){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit,i=t.oxw().rowData;t.xp6(1),t.Oqu(i[e.field])}}function q(n,o){if(1&n&&(t.TgZ(0,"td")(1,"container-element",33),t.YNc(2,O,3,2,"ng-container",34),t.YNc(3,j,2,1,"span",34),t.YNc(4,z,1,3,"i",35),t.YNc(5,P,1,3,"i",35),t.YNc(6,X,1,0,"i",36),t.YNc(7,W,2,1,"span",37),t.qZA()()),2&n){const e=o.$implicit;t.Udp("width",e.wd,"px"),t.xp6(1),t.Q6J("ngSwitch",e.field),t.xp6(1),t.Q6J("ngSwitchCase","name"),t.xp6(1),t.Q6J("ngSwitchCase","locationType"),t.xp6(1),t.Q6J("ngSwitchCase","isFixed"),t.xp6(1),t.Q6J("ngSwitchCase","isEnabled"),t.xp6(1),t.Q6J("ngSwitchCase","noteId")}}function tt(n,o){if(1&n&&(t.TgZ(0,"tr",32),t.YNc(1,q,8,8,"td",31),t.qZA()),2&n){const e=o.$implicit,i=o.columns;t.Q6J("ttContextMenuRow",e)("ttRow",e),t.xp6(1),t.Q6J("ngForOf",i)}}function et(n,o){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._uU(2,"No locations to display"),t.qZA()()),2&n){const e=t.oxw();t.xp6(1),t.uIk("colspan",e.cols.length)}}const ot=function(){return{width:"50vw","max-width":"600px"}};let r=class{constructor(o,e,i,a){this.pyramid=o,this.store=e,this.msg=i,this.ns=a,this.profile=null,this.locations$=new M.X(null),this.locations=[],this.nodes=[],this.tree=[],this.items=[],this.flatTree=[],this.treeState=[],this.task=0,this.scoped=!1,this.rotateIcon="pi pi-angle-double-down",this.rotateText="Expand"}ngOnInit(){this.cols=[{field:"name",header:"Location"},{field:"locationType",header:"Type"},{field:"description",header:"Description"},{field:"barcode",header:"Barcode"},{field:"layout",header:"Layout"},{field:"isFixed",header:"Fixed"},{field:"isEnabled",header:"Enabled"},{field:"noteId",header:"Notes"}],this.locations$.pipe((0,m.t)(this)).subscribe(o=>{o&&(this.locations=o,this.saveState(),this.nodes=this.gather(o),this.tree=[...this.nodes],this.flatTree=this.flatten(),this.restoreState())}),this.store.picklists$.pipe((0,m.t)(this)).subscribe(o=>this.picklists=o),this.store.profile$.pipe((0,m.t)(this)).subscribe(o=>this.profile=o),this.refreshStorage()}refreshStorage(){var o=this;return(0,g.Z)(function*(){const e=yield o.pyramid.list("Locations");e&&o.locations$.next(e)})()}taskText(){var o,e,i;return 1==this.task?"Add Top Level Location":2==this.task?`Add Location (${null===(e=null===(o=this.selectedNode)||void 0===o?void 0:o.data)||void 0===e?void 0:e.barcode})`:3==this.task?`Edit Location (${null===(i=this.model)||void 0===i?void 0:i.barcode})`:"Locations"}gather(o,e=0,i=[]){return o.filter(a=>a.parentId===e).sort((a,s)=>a.name<s.name?-1:1).forEach(a=>{const s={data:a,label:a.name,children:[]};i.push(s),this.gather(o,a.id,s.children)}),i}info(o){this.msg.add({severity:"info",summary:"Node Selected",detail:o})}level2(){this.flatTree.forEach(o=>o.expanded=!1),this.nodes.forEach(o=>o.expanded=!0),this.tree=[...this.nodes],this.updateRotate()}scope(o){this.tree=[o]}unScope(){this.tree=[...this.nodes]}setContextMenu(o){this.items=[{label:"Edit",icon:"pi pi-pencil",command:e=>this.editLocation(this.selectedNode)},{label:"Delete",icon:"pi pi-trash",command:e=>this.deleteLocation(this.selectedNode)},{label:"Add Location",icon:"pi pi-plus-circle",command:e=>this.addLocation(2,this.selectedNode.data.id)},{label:"Print Label",icon:"pi pi-qrcode",command:e=>this.printLabel(this.selectedNode)}]}addLocation(o,e=0){this.task=o,this.model=Object.assign(new v.Y,{parentId:e,isFixed:1,isEnabled:1,clientId:this.profile.clientId,changedBy:this.profile.id,changedOn:(new Date).toISOString()}),this.displayModal=!0}editLocation(o){this.task=3,this.model=Object.assign({},o.data),this.displayModal=!0}deleteLocation(o){var e=this;return(0,g.Z)(function*(){const i=o.data;(yield e.ns.confirm("Confirm Delete",`Are you sure you want to delete storage location ${i.name}?<br><br>\n      All contained locations will also be deleted, and all containers<br/>\n      held in these locations will be checked out.<br><br>\n      This cannot be undone`))&&e.info("Location deleted")})()}printLabel(o){this.info(`Print label for ${o.name}?`)}submit(){var o=this;return(0,g.Z)(function*(){if(o.displayModal=!1,o.model.id)yield o.pyramid.put("Locations",o.model);else{const e=yield o.pyramid.post("Locations",o.model);o.model.id=e.id}o.refreshStorage(),o.info("Location updated")})()}editNotes(o){this.ns.confirm("Notes","Edit note for location "+o.data.name)}flatten(o=null,e=[]){return null!=o||(o=this.nodes),o.filter(i=>{var a;return(null===(a=i.children)||void 0===a?void 0:a.length)>0}).forEach(i=>{e.push(i),this.flatten(i.children,e)}),e}rotateState(){"Expand"==this.rotateText?(this.saveState(),this.traverse(!0)):"Collapse"==this.rotateText?this.traverse(!1):this.restoreState()}traverse(o){this.flatTree.forEach(e=>e.expanded=o),this.tree=[...this.nodes],this.updateRotate()}saveState(){this.treeState=this.flatTree.filter(o=>{var e;return(null===(e=o.children)||void 0===e?void 0:e.length)>0&&o.expanded}).map(o=>o.data.id)}restoreState(){this.flatTree.forEach(o=>o.expanded=this.treeState.includes(o.data.id)),this.tree=[...this.nodes],this.updateRotate()}nodeExpand(o){this.updateRotate()}nodeCollapse(o){this.updateRotate()}updateRotate(){const o=this.flatTree.filter(e=>e.expanded).length;o==this.flatTree.length?(this.rotateText="Collapse",this.rotateIcon="pi pi-angle-double-up"):0==o&&this.treeState.length>0?(this.rotateText="Restore",this.rotateIcon="pi pi-share-alt"):(this.rotateText="Expand",this.rotateIcon="pi pi-angle-double-down")}};r.\u0275fac=function(o){return new(o||r)(t.Y36(y.tG),t.Y36(N.d),t.Y36(u.ez),t.Y36(c.c))},r.\u0275cmp=t.Xpm({type:r,selectors:[["storage"]],viewQuery:function(o,e){if(1&o&&t.Gf(d.iw,5),2&o){let i;t.iGM(i=t.CRH())&&(e.tt=i.first)}},features:[t._Bn([u.ez])],decls:13,vars:13,consts:[["header","Header",3,"visible","modal","draggable","resizable","visibleChange"],["pTemplate","header"],["pTemplate","content"],["pTemplate","footer"],[3,"model"],["cm",""],["selectionMode","single","dataKey","name","styleClass","p-treetable-sm",3,"value","columns","contextMenuSelection","contextMenu","autoLayout","onContextMenuSelect","contextMenuSelectionChange","onNodeExpand","onNodeCollapse"],["tt",""],["pTemplate","caption"],["pTemplate","body"],["pTemplate","emptymessage"],["icon","pencil",3,"title","close"],[1,"formgrid","grid"],[1,"field","col-12","md:col-6","mt-2"],["label","Name",3,"ngModel","ngModelChange"],["label","Location Type","picklist","LocationType",3,"ngModel","ngModelChange"],["label","Layout",3,"ngModel","ngModelChange"],["label","Description",3,"ngModel","ngModelChange"],["name","fixed","binary","false","label","Fixed",3,"falseValue","trueValue","ngModel","ngModelChange"],["name","enabled","binary","false","label","Enabled",3,"falseValue","trueValue","ngModel","ngModelChange"],[3,"reject","accept"],[1,"flex","align-items-center"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["type","text","pInputText","","size","20","placeholder","Search",2,"width","auto",3,"showClear","mouseup","input"],["search",""],["pButton","","pRipple","","type","button",1,"ml-2","p-button-text","p-button-secondary","p-button-sm",3,"label","icon","click"],["pButton","","pRipple","","type","button","label","L2",1,"ml-2","p-button-text","p-button-secondary","p-button-sm",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-arrow-up","label","Top","class","ml-2 p-button-text p-button-secondary p-button-sm",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","icon","pi pi-plus","pTooltip","New Location","tooltipPosition","left",1,"ml-auto","p-button-rounded",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-arrow-up","label","Top",1,"ml-2","p-button-text","p-button-secondary","p-button-sm",3,"click"],[3,"width",4,"ngFor","ngForOf"],[3,"ttContextMenuRow","ttRow"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"ngClass",4,"ngSwitchCase"],["class","pi pi-tags",3,"click",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"rowNode",4,"ngIf"],[3,"rowNode"],[3,"ngClass"],[1,"pi","pi-tags",3,"click"]],template:function(o,e){if(1&o&&(t._UZ(0,"p-toast"),t.TgZ(1,"p-dialog",0),t.NdJ("visibleChange",function(a){return e.displayModal=a}),t.YNc(2,H,1,1,"ng-template",1),t.YNc(3,I,14,11,"ng-template",2),t.YNc(4,K,1,0,"ng-template",3),t.qZA(),t._UZ(5,"p-contextMenu",4,5),t.TgZ(7,"p-treeTable",6,7),t.NdJ("onContextMenuSelect",function(a){return e.setContextMenu(a.node)})("contextMenuSelectionChange",function(a){return e.selectedNode=a})("onNodeExpand",function(a){return e.nodeExpand(a.node)})("onNodeCollapse",function(a){return e.nodeCollapse(a.node)}),t.YNc(9,k,9,4,"ng-template",8),t.YNc(10,B,2,1,"ng-template",1),t.YNc(11,tt,2,3,"ng-template",9),t.YNc(12,et,3,1,"ng-template",10),t.qZA()),2&o){const i=t.MAs(6);t.xp6(1),t.Akn(t.DdM(12,ot)),t.Q6J("visible",e.displayModal)("modal",!0)("draggable",!0)("resizable",!1),t.xp6(4),t.Q6J("model",e.items),t.xp6(2),t.Q6J("value",e.tree)("columns",e.cols)("contextMenuSelection",e.selectedNode)("contextMenu",i)("autoLayout",!0)}},dependencies:[p.mk,p.sg,p.O5,p.RF,p.n9,p.ED,h.JJ,h.On,u.jx,Z.Hq,w.XZ,J.xV,A.u,E.V,L.o,Q.FN,d.iw,d.gc,d.V4,d.NQ,Y.g,F.A,G.a,R.o,D.Y]}),r=(0,b.gn)([(0,m.c)()],r);const nt=[{path:"",component:r,canActivate:[T.a1]}];let at=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[x.Bz.forChild(nt),S.m,c.S8,c.zY,c.Gv,c.yn,c.cB,C.R]}),n})()}}]);