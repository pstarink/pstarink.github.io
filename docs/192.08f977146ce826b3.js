"use strict";(self.webpackChunkpyramid=self.webpackChunkpyramid||[]).push([[192],{3482:(w,h,s)=>{s.d(h,{a:()=>f});var p=s(1169);let f=(()=>{class r extends p.e{constructor(x){super(),Object.assign(this,x)}}return r.tableName="ContainerModels",r})()},9192:(w,h,s)=>{s.r(h),s.d(h,{ManageRecipesModule:()=>xe});var p=s(9808),f=s(6037),r=s(9600),b=s(7577),x=s(9028),J=s(4499),g=s(5861),S=s(655),M=s(9783),y=s(3482),C=s(6264),k=s(4987),u=s(9544),e=s(5e3),R=s(1528),A=s(2e3),T=s(2382),Z=s(845),I=s(1208),E=s(330),Q=s(4119),K=s(5315),G=s(1424),U=s(4204),Y=s(7773),H=s(1435),D=s(2501),L=s(5949),O=s(8821),V=s(3019),F=s(9165),z=s(7329),P=s(9711);function $(l,n){if(1&l){const t=e.EpF();e.TgZ(0,"dialog-header",10),e.NdJ("close",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.displayModal=!1)}),e.qZA()}if(2&l){const t=e.oxw();e.Q6J("title",t.taskText())}}function B(l,n){if(1&l){const t=e.EpF();e.TgZ(0,"div",22)(1,"form-select",23),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.model.roleType=i)}),e.qZA()()}if(2&l){const t=e.oxw(2);e.xp6(1),e.Q6J("ngModel",t.model.roleType)}}function j(l,n){if(1&l){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",18)(2,"form-number",24),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.def.wellRows=i)}),e.qZA()(),e.TgZ(3,"div",18)(4,"form-number",25),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.def.wellCols=i)}),e.qZA()(),e.TgZ(5,"div",18)(6,"form-number",26),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.volumeUnits=i)}),e.qZA()(),e.TgZ(7,"div",18)(8,"form-select",27),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.def.wellShapeType=i)}),e.qZA()(),e.TgZ(9,"div",28),e._uU(10),e.ALo(11,"json"),e.qZA(),e.BQk()}if(2&l){const t=e.oxw(2);e.xp6(2),e.Q6J("ngModel",t.def.wellRows),e.xp6(2),e.Q6J("ngModel",t.def.wellCols),e.xp6(2),e.Q6J("ngModel",t.volumeUnits),e.xp6(2),e.Q6J("ngModel",t.def.wellShapeType),e.xp6(2),e.Oqu(e.lcZ(11,5,t.def))}}function W(l,n){if(1&l){const t=e.EpF();e.TgZ(0,"div",11)(1,"div",12)(2,"form-text",13,14),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.model.key=i)}),e.qZA(),e._UZ(4,"val-errors",15),e.qZA(),e.TgZ(5,"div",12)(6,"form-text",16),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.model.name=i)}),e.qZA()(),e.YNc(7,B,2,1,"div",17),e.TgZ(8,"div",18)(9,"p-checkbox",19),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.model.isItem=i)}),e.qZA()(),e.TgZ(10,"div",18)(11,"p-checkbox",20),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.model.isEnabled=i)}),e.qZA()(),e.YNc(12,j,12,7,"ng-container",21),e.qZA(),e._UZ(13,"changed-info",7)}if(2&l){const t=e.MAs(3),o=e.oxw();e.xp6(2),e.Q6J("ngModel",o.model.key),e.xp6(2),e.Q6J("control",t.control),e.xp6(2),e.Q6J("ngModel",o.model.name),e.xp6(1),e.Q6J("ngIf",!o.model.parentId),e.xp6(2),e.Q6J("falseValue",0)("trueValue",1)("ngModel",o.model.isItem),e.xp6(2),e.Q6J("falseValue",0)("trueValue",1)("ngModel",o.model.isEnabled),e.xp6(1),e.Q6J("ngIf",o.isContainer),e.xp6(1),e.Q6J("model",o.model)}}function q(l,n){if(1&l){const t=e.EpF();e.TgZ(0,"dialog-footer",29),e.NdJ("reject",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.displayModal=!1)})("accept",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.submit())}),e.qZA()}}function X(l,n){if(1&l){const t=e.EpF();e.TgZ(0,"div",33)(1,"button",34),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.cancel())}),e.qZA(),e.TgZ(2,"p-button",35),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.create())}),e.qZA()()}}function ee(l,n){if(1&l&&(e.TgZ(0,"div",30),e._UZ(1,"tbl",31),e.YNc(2,X,3,0,"div",32),e.qZA()),2&l){const t=e.oxw();e.xp6(1),e.Q6J("value",t.recipes)("cols",t.cols),e.xp6(1),e.Q6J("ngIf",null==t.recipes?null:t.recipes.length)}}function te(l,n){1&l&&e._uU(0," Panel 2 ")}function ne(l,n){if(1&l){const t=e.EpF();e.TgZ(0,"div",41)(1,"span",42),e._UZ(2,"i",43),e.TgZ(3,"input",44,45),e.NdJ("mouseup",function(i){return i.target.select()})("input",function(i){e.CHM(t),e.oxw();const a=e.MAs(1);return e.KtG(a.filterGlobal(i.target.value,"contains"))}),e.qZA()(),e.TgZ(5,"button",46),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.rotateState())}),e.qZA(),e.TgZ(6,"button",47),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.addLookup(1))}),e.qZA()()}if(2&l){const t=e.oxw(2);e.xp6(3),e.Q6J("showClear",!0),e.xp6(2),e.Q6J("label",t.rotateText)("icon",t.rotateIcon)}}function oe(l,n){if(1&l&&(e.TgZ(0,"th"),e._uU(1),e.qZA()),2&l){const t=n.$implicit;e.Udp("width",t.wd,"px"),e.xp6(1),e.hij(" ",t.header," ")}}function ie(l,n){if(1&l&&(e.TgZ(0,"tr"),e.YNc(1,oe,2,3,"th",48),e.qZA()),2&l){const t=n.$implicit;e.xp6(1),e.Q6J("ngForOf",t)}}function le(l,n){if(1&l&&(e.ynx(0),e._UZ(1,"p-treeTableToggler",54),e._uU(2),e.BQk()),2&l){const t=e.oxw(2),o=t.$implicit,i=t.rowData;e.xp6(1),e.Q6J("rowNode",o),e.xp6(1),e.hij(" ",i.key," ")}}const N=function(l){return{"pi pi-check":l}};function ae(l,n){if(1&l&&e._UZ(0,"i",55),2&l){const t=e.oxw(2).rowData;e.Q6J("ngClass",e.VKq(1,N,t.isItem))}}function se(l,n){if(1&l&&e._UZ(0,"i",55),2&l){const t=e.oxw(2).rowData;e.Q6J("ngClass",e.VKq(1,N,t.isEnabled))}}function ce(l,n){if(1&l&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&l){const t=e.oxw(2).rowData,o=e.oxw(2);let i;e.xp6(1),e.Oqu(t.parentId?"":null!==(i=o.picklists.name[t.roleType])&&void 0!==i?i:"-")}}function pe(l,n){if(1&l&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&l){const t=e.oxw().$implicit,o=e.oxw().rowData;e.xp6(1),e.Oqu(o[t.field])}}function re(l,n){if(1&l&&(e.TgZ(0,"td")(1,"container-element",50),e.YNc(2,le,3,2,"ng-container",51),e.YNc(3,ae,1,3,"i",52),e.YNc(4,se,1,3,"i",52),e.YNc(5,ce,2,1,"span",51),e.YNc(6,pe,2,1,"span",53),e.qZA()()),2&l){const t=n.$implicit;e.Udp("width",t.wd,"px"),e.xp6(1),e.Q6J("ngSwitch",t.field),e.xp6(1),e.Q6J("ngSwitchCase","key"),e.xp6(1),e.Q6J("ngSwitchCase","isItem"),e.xp6(1),e.Q6J("ngSwitchCase","isEnabled"),e.xp6(1),e.Q6J("ngSwitchCase","roleType")}}function de(l,n){if(1&l&&(e.TgZ(0,"tr",49),e.YNc(1,re,7,7,"td",48),e.qZA()),2&l){const t=n.$implicit,o=n.columns;e.Q6J("ttContextMenuRow",t)("ttRow",t),e.xp6(1),e.Q6J("ngForOf",o)}}function me(l,n){if(1&l&&(e.TgZ(0,"tr")(1,"td"),e._uU(2,"No lookups to display"),e.qZA()()),2&l){const t=e.oxw(2);e.xp6(1),e.uIk("colspan",t.cols.length)}}function _e(l,n){if(1&l){const t=e.EpF();e.TgZ(0,"p-treeTable",36,37),e.NdJ("onContextMenuSelect",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.setContextMenu(i.node))})("contextMenuSelectionChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.selectedNode=i)})("onNodeSelect",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.nodeSelect(i.node))})("onNodeExpand",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.nodeExpand(i.node))})("onNodeCollapse",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.nodeCollapse(i.node))}),e.YNc(2,ne,7,3,"ng-template",38),e.YNc(3,ie,2,1,"ng-template",1),e.YNc(4,de,2,3,"ng-template",39),e.YNc(5,me,3,1,"ng-template",40),e.qZA()}if(2&l){const t=e.oxw(),o=e.MAs(10);e.Q6J("value",t.tree)("columns",t.cols)("scrollable",!0)("contextMenuSelection",t.selectedNode)("contextMenu",o)("autoLayout",!0)}}const ge=function(){return{width:"50vw","max-width":"600px"}},ue=function(){return{"min-height":"100%"}},he=function(){return[20,80]};let m=class{constructor(n,t,o,i,a){this.pyramid=n,this.biz=t,this.store=o,this.msg=i,this.ns=a,this.profile=null,this.picklists=null,this.nodes=[],this.tree=[],this.selectedNode={},this.flatTree=[],this.treeState=[],this.containerDefs=[],this.def=new y.a,this.task=0,this.isContainer=!1,this.volumeUnits=[0,0],this.rotateIcon="pi pi-angle-double-down",this.rotateText="Expand",this.recipes=[]}ngOnInit(){var n=this;return(0,g.Z)(function*(){n.cols=[{field:"name",header:"Name"},{field:"material",header:"Material",render:t=>{var o;return null===(o=t.material)||void 0===o?void 0:o.name}}],n.recipes=yield n.loadRecipes2(),console.log("Recipes",n.nodes)})()}onClick(n,t){this.ns.message(`${t.count} labels removed from worklist`),this.recipes=this.recipes.filter(o=>o!=t)}loadRecipes2(){var n=this;return(0,g.Z)(function*(){console.log("*loadRecipes");const t=[n.pyramid.list("Recipes"),n.pyramid.list("Ingredients"),n.pyramid.list("Materials")];let o=yield Promise.all(t);const c=o[2],d=[];return o[0].forEach(_=>{const v={id:_.id,name:_.name,material:c.find(Me=>Me.id===_.materialId)};d.push(v)}),d})()}loadRecipes(){var n=this;return(0,g.Z)(function*(){console.log("*loadRecipes");const t=[n.pyramid.list("Recipes"),n.pyramid.list("Ingredients"),n.pyramid.list("Materials")],[o,i,a]=yield Promise.all(t);return o.forEach(c=>{n.gatherIngredients(c,o,i,a)}),o})()}gatherIngredients(n,t,o,i){if(n.materialId){const a=i.find(c=>c.id==n.materialId);if(!a)throw new Error("Material not found");n.material=a}else n.ingredients=[],o.filter(c=>c.parentId===n.id).forEach(c=>{const d=t.find(v=>v.id==c.recipeId),_={id:c.recipeId,materialId:d.materialId,name:d.name,description:d.description,recipeType:d.recipeType,amount:c.amount,unitType:c.unitType};n.ingredients.push(_),this.gatherIngredients(_,t,o,i)})}taskText(){var n,t,o,i,a;return 1==this.task?"Add Picklist":2==this.task?`Add Option to PickList ${null===(n=this.selectedNode)||void 0===n?void 0:n.data.name} (${null===(o=null===(t=this.selectedNode)||void 0===t?void 0:t.data)||void 0===o?void 0:o.id})`:3==this.task?`Edit Picklist (${null===(i=this.model)||void 0===i?void 0:i.id})`:4==this.task?`Edit Option (${null===(a=this.model)||void 0===a?void 0:a.id})`:"Picklists & Options"}gather(n,t=0,o=[]){return n.filter(i=>i.parentId===t).sort((i,a)=>i.key<a.key?-1:1).forEach(i=>{const a={data:i,label:i.name,children:[]};o.push(a),this.gather(n,i.id,a.children)}),o}info(n){this.msg.add({severity:"info",detail:n})}setContextMenu(n){this.items=this.tree.includes(n)?[{label:"Edit",icon:"pi pi-pencil",command:t=>this.editLookup(3,this.selectedNode)},{label:"Delete",icon:"pi pi-trash",command:t=>this.deleteLookup(this.selectedNode.data)},{label:"Add Option",icon:"pi pi-plus-circle",command:t=>this.addLookup(2,this.selectedNode.data.id)}]:[{label:"Edit",icon:"pi pi-pencil",command:t=>this.editLookup(4,this.selectedNode)},{label:"Delete",icon:"pi pi-trash",command:t=>this.deleteLookup(this.selectedNode.data)},{label:"Print Label",icon:"pi pi-print",command:t=>this.printLabel(this.selectedNode.data)}]}addLookup(n,t=0){this.task=n,this.model=Object.assign(new C.t,{parentId:t,isEnabled:1,isItem:0,clientId:this.profile.clientId,changedBy:this.profile.id,changedOn:(new Date).toISOString()});const o=this.picklists.listById(t);this.isContainer=null==o?void 0:o.key.startsWith("Container"),this.isContainer&&(this.def=new y.a),this.displayModal=!0}editLookup(n,t){var o;this.task=n;const i=t.data;this.model=Object.assign({},i);const a=null===(o=t.parent)||void 0===o?void 0:o.data;if(this.isContainer=null==a?void 0:a.key.startsWith("Container"),this.isContainer){const c=this.containerDefs.find(d=>d.containerType==i.id);this.def=Object.assign({},c),this.volumeUnits=[null==c?void 0:c.wellVolume,null==c?void 0:c.unitType]}this.displayModal=!0}deleteLookup(n){var t=this;return(0,g.Z)(function*(){(yield t.ns.confirm("Confirm Delete",`Are you sure you want to delete lookup ${n.name}?<br><br>\n      This cannot be undone and any reference to options in this picklist wil be orphaned.`))&&(t.biz.deleteLookup(n),t.info("Option deleted"))})()}printLabel(n){this.info(`Print label for ${n.name}?`)}submit(){var n=this;return(0,g.Z)(function*(){var t,o;n.displayModal=!1;const i=n.model.id;if((o=n.model).name||(o.name=n.model.key),i)yield n.pyramid.put("Lookups",C.t.clean(n.model));else{const a=yield n.pyramid.post("Lookups",C.t.clean(n.model));n.model.id=a.id}if(n.isContainer){if(n.def.wellVolume=n.volumeUnits[0],n.def.unitType=n.volumeUnits[1],null!==(t=n.def)&&void 0!==t&&t.id)yield n.pyramid.put("ContainerModels",n.def);else{n.def.containerType=n.model.id;const a=yield n.pyramid.post("ContainerModels",n.def);n.def.id=a.id}n.containerDefs=yield n.pyramid.list("ContainerModels")}n.info("Lookup updated"),n.biz.loadPicklists()})()}nodeSelect(n){this.displayModal=!0,alert("SELECT")}flatten(n=null,t=[]){return n||(n=this.nodes),n.filter(o=>{var i;return(null===(i=o.children)||void 0===i?void 0:i.length)>0}).forEach(o=>{t.push(o),this.flatten(o.children,t)}),t}rotateState(){"Expand"==this.rotateText?(this.saveState(),this.traverse(!0)):"Collapse"==this.rotateText?this.traverse(!1):this.restoreState()}traverse(n){this.flatTree.forEach(t=>t.expanded=n),this.tree=[...this.nodes],this.updateRotate()}saveState(){this.treeState=this.flatTree.filter(n=>{var t;return(null===(t=n.children)||void 0===t?void 0:t.length)>0&&n.expanded}).map(n=>n.data.id)}restoreState(){this.flatTree.forEach(n=>n.expanded=this.treeState.includes(n.data.id)),this.tree=[...this.nodes],this.updateRotate()}nodeExpand(n){this.updateRotate()}nodeCollapse(n){this.updateRotate()}updateRotate(){const n=this.flatTree.filter(t=>t.expanded).length;n==this.flatTree.length?(this.rotateText="Collapse",this.rotateIcon="pi pi-angle-double-up"):0==n&&this.treeState.length>0?(this.rotateText="Restore",this.rotateIcon="pi pi-share-alt"):(this.rotateText="Expand",this.rotateIcon="pi pi-angle-double-down")}};m.\u0275fac=function(n){return new(n||m)(e.Y36(R.tG),e.Y36(R.Kc),e.Y36(A.d),e.Y36(M.ez),e.Y36(r.c))},m.\u0275cmp=e.Xpm({type:m,selectors:[["manage-recipes"]],viewQuery:function(n,t){if(1&n&&e.Gf(u.iw,5),2&n){let o;e.iGM(o=e.CRH())&&(t.tt=o.first)}},features:[e._Bn([M.ez])],decls:12,vars:14,consts:[[3,"visible","modal","draggable","resizable","visibleChange"],["pTemplate","header"],["pTemplate","content"],["pTemplate","footer"],[1,"min-h-full",3,"panelSizes"],["pTemplate",""],[1,"card","p-0"],[3,"model"],["cm",""],["selectionMode","single","dataKey","key","scrollHeight","flex","styleClass","p-treetable-sm",3,"value","columns","scrollable","contextMenuSelection","contextMenu","autoLayout","onContextMenuSelect","contextMenuSelectionChange","onNodeSelect","onNodeExpand","onNodeCollapse",4,"ngIf"],["icon","pencil",3,"title","close"],[1,"formgrid","grid","p-2"],[1,"field","col-6","mt-2"],["label","Key","required","true",3,"ngModel","ngModelChange"],["ctrl","ngModel"],["label","The key",3,"control"],["label","Name",3,"ngModel","ngModelChange"],["class","field col-12 mt-3",4,"ngIf"],[1,"field","col-12","md:col-6","mt-2"],["name","tangible","binary","false","label","Item",3,"falseValue","trueValue","ngModel","ngModelChange"],["name","enabled","binary","false","label","Enabled",3,"falseValue","trueValue","ngModel","ngModelChange"],[4,"ngIf"],[1,"field","col-12","mt-3"],["label","Access Role","picklist","Role",3,"ngModel","ngModelChange"],["label","Number of Rows",3,"ngModel","ngModelChange"],["label","Number of Columns",3,"ngModel","ngModelChange"],["label","Well Volume","decimals","3","units","Units.Volume",3,"ngModel","ngModelChange"],["label","Well shape","picklist","WellShape",3,"ngModel","ngModelChange"],[1,"m-2","p-2","text-sm","bg-yellow-50"],["acceptText","SUBMIT",3,"reject","accept"],[1,"w-full","h-full"],[3,"value","cols"],["class","flex mt-4 mb-2",4,"ngIf"],[1,"flex","mt-4","mb-2"],["pButton","","pRipple","","type","button","label","Clear",1,"p-button-text","ml-auto","mr-2",3,"click"],["label","Submit",1,"mr-2",3,"click"],["selectionMode","single","dataKey","key","scrollHeight","flex","styleClass","p-treetable-sm",3,"value","columns","scrollable","contextMenuSelection","contextMenu","autoLayout","onContextMenuSelect","contextMenuSelectionChange","onNodeSelect","onNodeExpand","onNodeCollapse"],["tt",""],["pTemplate","caption"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"flex","align-items-center"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["type","text","pInputText","","size","20","placeholder","Search",2,"width","auto",3,"showClear","mouseup","input"],["search",""],["pButton","","pRipple","","type","button",1,"ml-2","p-button-text","p-button-secondary","p-button-sm",3,"label","icon","click"],["pButton","","pRipple","","type","button","icon","pi pi-plus","pTooltip","New Picklist","tooltipPosition","left",1,"ml-auto","p-button-rounded",3,"click"],[3,"width",4,"ngFor","ngForOf"],[3,"ttContextMenuRow","ttRow"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"ngClass",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"rowNode"],[3,"ngClass"]],template:function(n,t){1&n&&(e._UZ(0,"p-toast"),e.TgZ(1,"p-dialog",0),e.NdJ("visibleChange",function(i){return t.displayModal=i}),e.YNc(2,$,1,1,"ng-template",1),e.YNc(3,W,14,12,"ng-template",2),e.YNc(4,q,1,0,"ng-template",3),e.qZA(),e.TgZ(5,"p-splitter",4),e.YNc(6,ee,3,3,"ng-template",5),e.YNc(7,te,1,0,"ng-template",5),e.qZA(),e._UZ(8,"div",6)(9,"p-contextMenu",7,8),e.YNc(11,_e,6,6,"p-treeTable",9)),2&n&&(e.xp6(1),e.Akn(e.DdM(11,ge)),e.Q6J("visible",t.displayModal)("modal",!0)("draggable",!0)("resizable",!1),e.xp6(4),e.Akn(e.DdM(12,ue)),e.Q6J("panelSizes",e.DdM(13,he)),e.xp6(4),e.Q6J("model",t.items),e.xp6(2),e.Q6J("ngIf",!1))},dependencies:[p.mk,p.sg,p.O5,p.RF,p.n9,p.ED,T.JJ,T.Q7,T.On,M.jx,Z.Hq,Z.zx,I.XZ,E.xV,Q.u,K.V,G.o,U.q,Y.FN,u.iw,u.gc,u.V4,u.NQ,H.tM,D.g,L.A,O.a,V.Z,F.o,z.Y,P.$,p.Ts]}),m=(0,S.gn)([(0,k.c)()],m);const fe=[{path:"",component:m,canActivate:[x.a1]}];let xe=(()=>{class l{}return l.\u0275fac=function(t){return new(t||l)},l.\u0275mod=e.oAB({type:l}),l.\u0275inj=e.cJS({imports:[p.ez,f.Bz.forChild(fe),J.m,b.R,r.S8,r.zY,r.Gv,r.yn,r.cB,r.NY]}),l})()}}]);