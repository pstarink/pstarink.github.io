"use strict";(self.webpackChunkpyramid=self.webpackChunkpyramid||[]).push([[414],{7414:(S,q,e)=>{e.r(q),e.d(q,{AliquotModule:()=>Q});var p=e(9808),b=e(6037),m=e(9600),T=e(7577),C=e(9028),J=e(4499),f=e(5861),N=e(655),c=e(2382),v=e(4987),g=e(1528),A=e(9783),t=e(5e3),Z=e(845),k=e(7773),h=e(1435),Y=e(6347),I=e(3019),x=e(9165),U=e(9711);function $(l,o){if(1&l&&(t.TgZ(0,"small",19),t._uU(1),t.qZA()),2&l){const n=t.oxw();t.xp6(1),t.hij("",n.label||"This"," barcode is the wrong length")}}function j(l,o){1&l&&(t.TgZ(0,"small",20),t._uU(1,"REQUIRED"),t.qZA())}function E(l,o){if(1&l){const n=t.EpF();t.TgZ(0,"div",21)(1,"button",22),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.cancel())}),t.qZA(),t.TgZ(2,"p-button",23),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.create())}),t.qZA()()}}function F(l,o){if(1&l&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&l){const n=o.$implicit;t.xp6(1),t.lnq(" ",n.control,": ",n.key," = ",n.errorValue," ")}}let u=class{constructor(o,n,r,i,d){this.pyramid=o,this.store=n,this.biz=r,this.fb=i,this.ns=d,this.picklists=null,this.containerDefs=[],this.aliquots=[],this.errors=[],this._aliquots=[{recipe:171,quantity:[35,144],destination:"100053"},{recipe:171,quantity:[120,144],destination:"100074"}],this.cols=[{field:"recipe",header:"Recipe",render:s=>{var a,y;return null!==(y=null===(a=this.picklists)||void 0===a?void 0:a.name[s.recipe])&&void 0!==y?y:"-"}},{field:"quantity",header:"quantity",render:s=>{var a;return`${s.quantity[0]} ${null===(a=this.picklists)||void 0===a?void 0:a.name[s.quantity[1]]}`}},{field:"destination",header:"Destination"},{type:"icon",icon:"delete",wd:30,click:(s,a)=>this.onClick(s,a)}]}ngOnInit(){var o=this;return(0,f.Z)(function*(){o.store.profile$.pipe((0,v.t)(o)).subscribe(n=>o.profile=n),o.store.picklists$.pipe((0,v.t)(o)).subscribe(n=>{o.picklists=n,o.aliquots=o._aliquots}),o.form=o.fb.group({recipe:[null,[]],quantity:[null,[]],destination:[null,[c.kI.required]]}),o.form.get("destination").valueChanges.subscribe(n=>{console.log(`source changed to ${n}`)})})()}onClick(o,n){"delete"==o&&(this.aliquots=this.aliquots.filter(r=>r!=n),this.ns.toast("Worklist item removed"))}onRecipe(o){console.log(o)}onDestination(o){this.addItems(),this.form.patchValue({destination:null})}addItems(){if(!this.form.invalid){const o=Object.assign({},this.form.value);this.aliquots=[...this.aliquots,o]}}create(){var o=this;return(0,f.Z)(function*(){const n=[],r=(new Date).toISOString();o.aliquots.forEach(i=>{var d,s;console.log(`Aliquot ${i.quantity[0]} ${null===(d=o.picklists)||void 0===d?void 0:d.name[i.quantity[1]]} of ${null===(s=o.picklists)||void 0===s?void 0:s.name[i.recipe]} to ${i.destination}`),n.push({barcode:i.destination,wells:[{row:0,col:0,wellStatus:o.picklists.idByKey("WellStatus|Valid"),contents:[{recipeId:i.recipe,quantity:i.quantity[0],unitType:i.quantity[1],clientId:o.profile.clientId,changedBy:o.profile.id,changedOn:r}]}]})}),n.length>0&&(yield o.pyramid.setContents(n)),o.aliquots=[]})()}cancel(){var o=this;return(0,f.Z)(function*(){o.aliquots.length>0&&(yield o.ns.confirm("Clear Worklist","Are you sure you want to remove all worklist items?"))&&(o.aliquots=[])})()}getFormValidationErrors(o){this.errors=[],Object.keys(this.form.controls).forEach(n=>{const r=this.form.get(n).errors;null!=r&&Object.keys(r).forEach(i=>{this.errors.push({control:n,keyError:i,errorValue:r[i]})})})}};u.\u0275fac=function(o){return new(o||u)(t.Y36(g.tG),t.Y36(g.d6),t.Y36(g.Kc),t.Y36(c.QS),t.Y36(m.c))},u.\u0275cmp=t.Xpm({type:u,selectors:[["app-aliquot"]],features:[t._Bn([A.YP,A.ez])],decls:29,vars:15,consts:[[1,"flex","flex-column"],[1,"card"],[3,"formGroup","ngSubmit"],[1,"formgrid","grid"],[1,"field","col-12","md:col-6","lg:col-4"],["formControlName","recipe","label","Recipe","prompt","Consumable recipe","picklist","Recipe",3,"changed"],["formControlName","quantity","label","Quantity","prompt","Quantity to initialize","decimals","2","units","Units"],[1,"formgrid","grid","mb-3"],[1,"field","col-12","md:col-6","lg:col-4","mt-3"],["name","dst","formControlName","destination","label","Destination","prompt","Destination container barcode",3,"keyup.enter"],["controlName","destination"],["valError","barcodeLength"],["valError","required"],["label","Add to Worklist","icon","pi pi-sort-down","iconPos","right",1,"mt-4",3,"disabled","click"],[1,"pt-2","text-dark"],[1,"card","p-0"],[3,"value","cols"],["class","flex mt-2 mb-2",4,"ngIf"],[4,"ngFor","ngForOf"],[2,"color","red"],[2,"color","orange"],[1,"flex","mt-2","mb-2"],["pButton","","type","button","label","Clear",1,"p-button-outlined","p-button-secondary","ml-auto","mr-2",3,"click"],["label","Submit",1,"mr-2",3,"click"]],template:function(o,n){1&o&&(t._UZ(0,"p-toast"),t.TgZ(1,"div",0)(2,"div",1)(3,"form",2),t.NdJ("ngSubmit",function(){return n.addItems()}),t.TgZ(4,"div",3)(5,"div",4)(6,"form-select",5),t.NdJ("changed",function(i){return n.onRecipe(i)}),t.qZA()(),t.TgZ(7,"div",4),t._UZ(8,"form-number",6),t.qZA()(),t.TgZ(9,"div",7)(10,"div",8)(11,"form-barcode",9),t.NdJ("keyup.enter",function(i){return n.onDestination(i.target.value)}),t.qZA(),t.TgZ(12,"val-errors",10),t.YNc(13,$,2,1,"ng-template",11),t.YNc(14,j,2,0,"ng-template",12),t.qZA()()(),t.TgZ(15,"p-button",13),t.NdJ("click",function(){return n.addItems()}),t.qZA()(),t.TgZ(16,"div",14),t._uU(17),t.ALo(18,"json"),t.qZA()(),t.TgZ(19,"div",15),t._UZ(20,"tbl",16),t.YNc(21,E,3,0,"div",17),t.qZA(),t.TgZ(22,"p"),t._uU(23),t.ALo(24,"json"),t.qZA(),t.TgZ(25,"p"),t._uU(26),t.ALo(27,"json"),t.qZA(),t.YNc(28,F,2,3,"div",18),t.qZA()),2&o&&(t.xp6(3),t.Q6J("formGroup",n.form),t.xp6(12),t.Q6J("disabled",n.form.invalid),t.xp6(2),t.Oqu(t.lcZ(18,9,n.form.value)),t.xp6(3),t.Q6J("value",n.aliquots)("cols",n.cols),t.xp6(1),t.Q6J("ngIf",null==n.aliquots?null:n.aliquots.length),t.xp6(2),t.hij("Form value: ",t.lcZ(24,11,n.form.value),""),t.xp6(3),t.hij("Form status: ",t.lcZ(27,13,n.form.status),""),t.xp6(2),t.Q6J("ngForOf",n.errors))},dependencies:[p.sg,p.O5,c._Y,c.JJ,c.JL,c.sg,c.u,Z.Hq,Z.zx,k.FN,h.tM,h.HY,Y.J,I.Z,x.o,U.$,p.Ts]}),u=(0,N.gn)([(0,v.c)()],u);const O=[{path:"",component:u,canActivate:[C.a1]}];let Q=(()=>{class l{}return l.\u0275fac=function(n){return new(n||l)},l.\u0275mod=t.oAB({type:l}),l.\u0275inj=t.cJS({imports:[p.ez,J.m,b.Bz.forChild(O),m.cB,m.Gv,m.yn,m.zY,T.R,m.NY,h.bQ]}),l})()}}]);